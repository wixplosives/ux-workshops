"use strict";(self.webpackChunk_wixc3_component_playground=self.webpackChunk_wixc3_component_playground||[]).push([[6479],{36041:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.defineGlobalStateResource=void 0;const r=s(93849),n=s(5689);t.defineGlobalStateResource=()=>r.Service.withType().defineEntity(n.mainEnv);const i=new r.Feature({id:"reactResources",api:{createStateResource:r.Service.withType().defineEntity(n.mainEnv)},dependencies:[]});t.default=i},89877:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Batcher=void 0;const r=s(98522);t.Batcher=class{constructor(){this.registered={},this.registeredAtomic={},this.inAtomic=!1,this.atomicSnapshots={},this.batching=!1,this.subscribers=new Set,this.changed={},this.changedStatus={}}subscribe(e){this.subscribers.add(e)}unsubscribe(e){this.subscribers.delete(e)}isBatching(){return this.batching}getRunningBatchId(){return this.runningBatchId}batchAll(e,t){if(this.runningBatchId=void 0===t?Math.random():t,this.batching)throw new Error("already batching");this.batching=!0;try{e(),this.batching=!1;const t=this.runningBatchId,s=this.commit(this.runningBatchId);return this.runningBatchId===t&&(this.runningBatchId=void 0),s}catch(e){return this.batching=!1,console.error(e),this.runningBatchId?this.revert(e,this.runningBatchId):this.createFailureEvent(e,t)}}batchIfNeeded(e){this.batching?e():this.batchAll(e)}runAtomic(e,t=Math.random()){if(this.inAtomic){const s=this.batchAll(e,t);return this.inAtomic=!1,s}this.inAtomic=!0;try{const s=this.batchAll(e,t);if("failure"===s.status)throw s.error;return this.inAtomic=!1,this.disposeAtomicSnapshots(t),this.atomicSnapshots={},s}catch(e){return console.error(e),this.atomicSnapshots[t]&&this.batchAll((()=>{for(const e of Object.keys(this.atomicSnapshots[t]))for(const s of this.registeredAtomic[t][e]){const n=this.atomicSnapshots[t][e][s.getSerializedId()];n&&s.applyChange((0,r.fullChange)(s.getProjection(n)))}})),this.inAtomic=!1,this.disposeAtomicSnapshots(t),this.atomicSnapshots={},this.createFailureEvent(e,t||-1)}}getAtomicSnapshot(e,t){if(this.runningBatchId&&this.atomicSnapshots[this.runningBatchId])return(this.atomicSnapshots[this.runningBatchId][e]||{})[t]}setAtomicSnapshot(e,t,s){if(!this.runningBatchId)throw new Error("trying to set snap in unknown batch");this.atomicSnapshots[this.runningBatchId]||(this.atomicSnapshots[this.runningBatchId]={}),this.atomicSnapshots[this.runningBatchId][e]||(this.atomicSnapshots[this.runningBatchId][e]={}),this.atomicSnapshots[this.runningBatchId][e][t]||(this.atomicSnapshots[this.runningBatchId][e][t]=s)}registerForBatch(e,t,s,r){if(!this.runningBatchId)throw new Error("registering to non existant batch");this.registered[this.runningBatchId]||(this.registered[this.runningBatchId]={}),this.registered[this.runningBatchId][s]||(this.registered[this.runningBatchId][s]=new Set),this.inAtomic&&(this.registeredAtomic[this.runningBatchId]||(this.registeredAtomic[this.runningBatchId]={}),this.registeredAtomic[this.runningBatchId][s]||(this.registeredAtomic[this.runningBatchId][s]=new Set)),r?(this.changedStatus[this.runningBatchId]||(this.changedStatus[this.runningBatchId]={}),this.changedStatus[this.runningBatchId][s]||(this.changedStatus[this.runningBatchId][s]=new Set)):(this.changed[this.runningBatchId]||(this.changed[this.runningBatchId]={}),this.changed[this.runningBatchId][s]||(this.changed[this.runningBatchId][s]=new Set)),this.registered[this.runningBatchId][s].add(e),this.inAtomic&&this.registeredAtomic[this.runningBatchId][s].add(e),r?this.changedStatus[this.runningBatchId][s].add(t):this.changed[this.runningBatchId][s].add(t)}unregisterFromBatch(e,t,s){this.runningBatchId&&(this.registered[this.runningBatchId]&&this.registered[this.runningBatchId][s]&&this.registered[this.runningBatchId][s].delete(e),this.registeredAtomic[this.runningBatchId]&&this.registeredAtomic[this.runningBatchId][s]&&this.registeredAtomic[this.runningBatchId][s].delete(e),this.changed[this.runningBatchId]&&this.changed[this.runningBatchId][s]&&this.changed[this.runningBatchId][s].delete(t),this.changedStatus[this.runningBatchId]&&this.changedStatus[this.runningBatchId][s]&&this.changedStatus[this.runningBatchId][s].delete(t))}disposeAtomicSnapshots(e){if(this.atomicSnapshots[e])for(const t of Object.keys(this.atomicSnapshots[e]))for(const s of Object.keys(this.atomicSnapshots[e][t]))this.atomicSnapshots[e][t][s].dispose()}commit(e){let t=!1;if(this.registered[e])for(const s of Object.keys(this.registered[e]))for(const r of this.registered[e][s])r.commit(e),t=!0;const s=this.createSuccessEvent(e);return t&&this.dispatch(s),s}revert(e,t){if(this.registered[t]){for(const e of Object.keys(this.registered[t]))for(const s of this.registered[t][e])s.revert();delete this.registered[t]}return this.createFailureEvent(e,t)}dispatch(e){for(const t of this.subscribers)t(e)}createFailureEvent(e,t){return{status:"failure",error:e,batchId:t}}createSuccessEvent(e){const t={status:"success",changed:{},changedStatus:{},batchId:e};if(this.registered[e])for(const s of Object.keys(this.registered[e])){if(this.changed[e]&&this.changed[e][s]&&0!==this.changed[e][s].size){const r=[...this.changed[e][s]];t.changed[s]=r}if(this.changedStatus[e]&&this.changedStatus[e][s]&&0!==this.changedStatus[e][s].size){const r=[...this.changedStatus[e][s]];t.changedStatus[s]=r}}return delete this.registered[e],delete this.changed[e],delete this.changedStatus[e],t}}},65089:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.definePluggableComputedResource=t.PluggableComputedResourceDefinition=t.PluggableComputedResourceCreator=void 0;const r=s(93849),n=s(25076),i=s(13980),o=s(77952);class a extends i.ComputedResourceCreator{constructor(e,t,s,r){super(e,t,s,r)}consume(e,t){const{managerConstructor:s,resourceConstructor:r}=e;return super.consume({managerConstructor:s,resourceConstructor:r||n.PluggableResource},t)}provide(e){const{resourceConstructor:t,managerConstructor:s,handler:r,dispose:i,dependencies:o}=e;return super.provide({handler:r,dispose:i,managerConstructor:s,resourceConstructor:t||n.PluggableResource,dependencies:o})}}t.PluggableComputedResourceCreator=a;class c extends o.BasePluggableResourceDefinition{constructor(e,t){super(t),this.resourceFeature=e}[r.CREATE_RUNTIME](e,t,s){const r=e.entityID(t,s);return new a(this.env,r,e,this.resourceFeature)}}t.PluggableComputedResourceDefinition=c,t.definePluggableComputedResource=function(e){return()=>({defineEntity:t=>new c(e,t)})}},13980:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.defineComputedResource=t.ComputedResourceDefinition=t.ComputedResourceCreator=void 0;const r=s(93849),n=s(14572),i=s(98593),o=s(73836),a=s(91792),c=s(77952);class u extends c.BaseResourceCreator{constructor(e,t,s,r){super(e,t,s,r)}consume(e,t){const{managerConstructor:s,resourceConstructor:r,manipulator:i}=e,c=(null==t?void 0:t.id)||this.definitionENV.env;return this.getConsumer(new a.OneWayStrategySlave(r||n.Resource,c,this.getConsumerTypeName(t),this.batcher,i||new o.JsonManipulator,this.syncer.subscribeToRemote),s,t)}provide(e){const{resourceConstructor:t,managerConstructor:s,manipulator:r,handler:a,dependencies:c}=e;return this.getProvider({strategy:new i.OneWayComputedStrategyMaster(t||n.Resource,this.definitionENV.env,this.getProviderTypeName(),this.batcher,r||new o.JsonManipulator,a),dependenciesBaseTypeNames:c.map((e=>e.baseTypeName)),managerConstructor:s})}}t.ComputedResourceCreator=u;class h extends c.BaseResourceDefinition{constructor(e,t){super(t),this.resourceFeature=e}[r.CREATE_RUNTIME](e,t,s){const r=e.entityID(t,s);return new u(this.env,r,e,this.resourceFeature)}}t.ComputedResourceDefinition=h,t.defineComputedResource=function(e){return()=>({defineEntity:t=>new h(e,t)})}},16670:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.defineIncrementalComputedResource=t.IncrementalComputedResourceDefinition=t.IncrementalComputedResourceCreator=void 0;const r=s(93849),n=s(14572),i=s(73836),o=s(91792),a=s(77952),c=s(99540);class u extends a.BaseResourceCreator{constructor(e,t,s,r){super(e,t,s,r)}consume(e,t){const{managerConstructor:s,resourceConstructor:r,manipulator:a}=e,c=(null==t?void 0:t.id)||this.definitionENV.env;return this.getConsumer(new o.OneWayStrategySlave(r||n.Resource,c,this.getConsumerTypeName(t),this.batcher,a||new i.JsonManipulator,this.syncer.subscribeToRemote),s,t)}provide(e){var t;const{resourceConstructor:s,managerConstructor:r,manipulator:o,handler:a,dependencies:u}=e;return this.getProvider({strategy:new c.OneWayIncrementalComputedStrategyMaster(s||n.Resource,this.definitionENV.env,this.getProviderTypeName(),this.batcher,o||new i.JsonManipulator,a,{maxWorkTime:e.maxWorkTime,minSleepTime:e.minSleepTime,startValue:e.startValue,emptyValue:null!==(t=e.emptyValue)&&void 0!==t?t:{...e.startValue,progress:1},changeBufferTime:e.changeBufferTime}),dependenciesBaseTypeNames:u.map((e=>e.baseTypeName)),managerConstructor:r})}}t.IncrementalComputedResourceCreator=u;class h extends a.BaseResourceDefinition{constructor(e,t){super(t),this.resourceFeature=e}[r.CREATE_RUNTIME](e,t,s){const r=e.entityID(t,s);return new u(this.env,r,e,this.resourceFeature)}}t.IncrementalComputedResourceDefinition=h,t.defineIncrementalComputedResource=function(e){return()=>({defineEntity:t=>new h(e,t)})}},61928:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.defineOneWayResource=t.OneWayResourceDefinition=t.OneWayResourceCreator=void 0;const r=s(93849),n=s(14572),i=s(91792),o=s(73836),a=s(77952);class c extends a.BaseResourceCreator{constructor(e,t,s,r){super(e,t,s,r)}consume(e,t){const{managerConstructor:s,resourceConstructor:r,manipulator:a}=e,c=(null==t?void 0:t.id)||this.definitionENV.env;return this.getConsumer(new i.OneWayStrategySlave(r||n.Resource,c,this.getConsumerTypeName(t),this.batcher,a||new o.JsonManipulator,this.syncer.subscribeToRemote),s,t)}provide(e){const{resourceConstructor:t,managerConstructor:s,manipulator:r,handler:a}=e;return this.getProvider({managerConstructor:s,strategy:new i.OneWayStrategyMaster(t||n.Resource,this.definitionENV.env,this.getProviderTypeName(),this.batcher,r||new o.JsonManipulator,a)})}}t.OneWayResourceCreator=c;class u extends a.BaseResourceDefinition{constructor(e,t){super(t),this.resourceFeature=e}[r.CREATE_RUNTIME](e,t,s){const r=e.entityID(t,s);return new c(this.env,r,e,this.resourceFeature)}}t.OneWayResourceDefinition=u,t.defineOneWayResource=function(e){return()=>({defineEntity:t=>new u(e,t)})}},85494:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.definePluggableResource=t.PluggableResourceDefinition=t.PluggableResourceCreator=void 0;const r=s(93849),n=s(25076),i=s(61928),o=s(77952);class a extends i.OneWayResourceCreator{constructor(e,t,s,r){super(e,t,s,r)}consume(e,t){const{managerConstructor:s,resourceConstructor:r}=e;return super.consume({managerConstructor:s,resourceConstructor:r||n.PluggableResource},t)}provide(e){const{resourceConstructor:t,managerConstructor:s,handler:r,dispose:i}=e;return super.provide({handler:r,dispose:i,managerConstructor:s,resourceConstructor:t||n.PluggableResource})}}t.PluggableResourceCreator=a;class c extends o.BasePluggableResourceDefinition{constructor(e,t){super(t),this.resourceFeature=e}[r.CREATE_RUNTIME](e,t,s){const r=e.entityID(t,s);return new a(this.env,r,e,this.resourceFeature)}}t.PluggableResourceDefinition=c,t.definePluggableResource=function(e){return()=>({defineEntity:t=>new c(e,t)})}},64620:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.defineQueryResource=t.QueryResourceDefinition=t.QueryResourceCreator=void 0;const r=s(93849),n=s(77163),i=s(90294),o=s(77952);class a extends o.BaseResourceCreator{constructor(e,t,s,r){super(e,t,s,r)}consume(e,t){const{managerConstructor:s,resourceConstructor:r,results:o}=e,a=(null==t?void 0:t.id)||this.definitionENV.env;return this.getConsumer(new n.QueryStrategySlave(r||i.QueryResource,a,this.getConsumerTypeName(t),this.batcher,this.syncer.subscribeToRemote,o.map((e=>e.getTypeName())),this.syncer.get.bind(this.syncer)),s,t)}provide(e){const{resourceConstructor:t,managerConstructor:s,handler:r,dependencies:o,results:a}=e;return this.getProvider({managerConstructor:s,strategy:new n.QueryStrategyMaster(t||i.QueryResource,this.definitionENV.env,this.getProviderTypeName(),this.batcher,a.map((e=>e.getTypeName())),o.map((e=>e.getTypeName())),r)})}}t.QueryResourceCreator=a;class c extends o.BaseResourceDefinition{constructor(e,t){super(t),this.resourceFeature=e}[r.CREATE_RUNTIME](e,t,s){const r=e.entityID(t,s);return new a(this.env,r,e,this.resourceFeature)}}t.QueryResourceDefinition=c,t.defineQueryResource=function(e){return()=>({defineEntity:t=>new c(e,t)})}},77952:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.BasePluggableResourceDefinition=t.BaseResourceDefinition=t.BaseResourceCreator=void 0;const r=s(93849),n=s(91570),i=s(86307),o=s(25076);t.BaseResourceCreator=class{constructor(e,t,s,n){this.definitionENV=e,this.baseTypeName=t,this.context=s,this.managers={};const i=s.get(n).api,o=s.get(r.COM).api;this.comunication=o.communication,this.syncer=i.syncer,this.batcher=i.batcher,this.logger=o.loggerService,this.connectorId=s.entityID(n.id,"syncerConnector"),this.rApiID=s.entityID(n.id,"remoteSyncer")}getConsumerTypeName(e){return e?e.id+"#"+this.baseTypeName:this.baseTypeName}getProviderTypeName(){return"single"===this.definitionENV.endpointType?this.baseTypeName:this.comunication.getEnvironmentId()+"#"+this.baseTypeName}getConsumer(e,t,s){const r=this.getConsumerTypeName(s),o=t||i.ResourceManager,a=s||{id:this.definitionENV.env};if(this.managers[a.id])return this.managers[a.id];const c=new o(e,r,this.syncer,this.batcher,this.logger,this.baseTypeName,[]);if(!this.comunication.isServer){const e=this.comunication.apiProxy(a,{id:this.connectorId}),t=this.comunication.apiProxy(a,{id:this.rApiID});this.syncer.hasSyncer(a.id)||(e.connect(this.syncer.id).catch(n.reportError),this.syncer.connectSyncer(a.id,t))}return this.managers[a.id]=c,c}getProvider({strategy:e,managerConstructor:t,dependenciesBaseTypeNames:s}){const r=this.getProviderTypeName();return new(t||i.ResourceManager)(e,r,this.syncer,this.batcher,this.logger,this.baseTypeName,s||[])}};class a extends r.FeatureOutput{constructor(e){super(e,r.Universal,!0),this.env=e}defineConsumer(e){return r.Service.withType().defineEntity(e)}[r.CREATE_RUNTIME](e,t,s){return null}[r.REGISTER_VALUE](e,t,s,r,n){return t||s}}t.BaseResourceDefinition=a,t.BasePluggableResourceDefinition=class extends a{entry(e,t,s=o.defaultMergeConfig){return new o.PluggableResourceEntryDefinition(t,e,s)}}},73175:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.definePluggableTwoWayComputedResource=t.PluggableTwoWayComputedResourceDefinition=t.PluggableTwoWayComputedResourceCreator=void 0;const r=s(93849),n=s(25076),i=s(87588),o=s(77952);class a extends i.TwoWayComputedResourceCreator{constructor(e,t,s,r){super(e,t,s,r)}consume(e,t){const{managerConstructor:s,resourceConstructor:r}=e;return super.consume({managerConstructor:s,resourceConstructor:r||n.PluggableResource},t)}provide(e){const{resourceConstructor:t,managerConstructor:s,handler:r,dispose:i,dependencies:o}=e;return super.provide({handler:r,dispose:i,managerConstructor:s,resourceConstructor:t||n.PluggableResource,dependencies:o})}}t.PluggableTwoWayComputedResourceCreator=a;class c extends o.BasePluggableResourceDefinition{constructor(e,t){super(t),this.resourceFeature=e}[r.CREATE_RUNTIME](e,t,s){const r=e.entityID(t,s);return new a(this.env,r,e,this.resourceFeature)}}t.PluggableTwoWayComputedResourceDefinition=c,t.definePluggableTwoWayComputedResource=function(e){return()=>({defineEntity:t=>new c(e,t)})}},87588:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.defineTwoWayComputedResource=t.TwoWayComputedResourceDefinition=t.TwoWayComputedResourceCreator=void 0;const r=s(93849),n=s(14572),i=s(73836),o=s(80375),a=s(77952);class c extends a.BaseResourceCreator{constructor(e,t,s,r){super(e,t,s,r)}consume(e,t){const{managerConstructor:s,resourceConstructor:r,manipulator:a}=e,c=(null==t?void 0:t.id)||this.definitionENV.env;return this.getConsumer(new o.TwoWayComputedStrategySlave(r||n.Resource,c,this.getConsumerTypeName(t),this.batcher,a||new i.JsonManipulator,this.syncer.subscribeToRemote,this.logger),s,t)}provide(e){const{resourceConstructor:t,managerConstructor:s,manipulator:r,handler:a,dependencies:c}=e;return this.getProvider({managerConstructor:s,strategy:new o.TwoWayComputedStrategyMaster(t||n.Resource,this.definitionENV.env,this.getProviderTypeName(),this.batcher,this.syncer,r||new i.JsonManipulator,c.map((e=>e.getTypeName())),a)})}}t.TwoWayComputedResourceCreator=c;class u extends a.BaseResourceDefinition{constructor(e,t){super(t),this.resourceFeature=e}[r.CREATE_RUNTIME](e,t,s){const r=e.entityID(t,s);return new c(this.env,r,e,this.resourceFeature)}}t.TwoWayComputedResourceDefinition=u,t.defineTwoWayComputedResource=function(e){return()=>({defineEntity:t=>new u(e,t)})}},95561:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.defineTwoWayResource=t.TwoWayResourceDefinition=t.TwoWayResourceCreator=void 0;const r=s(93849),n=s(14572),i=s(72288),o=s(73836),a=s(77952);class c extends a.BaseResourceCreator{constructor(e,t,s,r){super(e,t,s,r)}consume(e,t){const{managerConstructor:s,resourceConstructor:r,manipulator:a}=e,c=(null==t?void 0:t.id)||this.definitionENV.env;return this.getConsumer(new i.TwoWayStrategySlave(r||n.Resource,c,this.getConsumerTypeName(t),this.batcher,a||new o.JsonManipulator,this.syncer.subscribeToRemote,this.logger),s,t)}provide(e){const{resourceConstructor:t,managerConstructor:s,manipulator:r,handler:a}=e;return this.getProvider({managerConstructor:s,strategy:new i.TwoWayStrategyMaster(t||n.Resource,this.definitionENV.env,this.getProviderTypeName(),this.batcher,r||new o.JsonManipulator,a)})}}t.TwoWayResourceCreator=c;class u extends a.BaseResourceDefinition{constructor(e,t){super(t),this.resourceFeature=e}[r.CREATE_RUNTIME](e,t,s){const r=e.entityID(t,s);return new c(this.env,r,e,this.resourceFeature)}}t.TwoWayResourceDefinition=u,t.defineTwoWayResource=function(e){return()=>({defineEntity:t=>new u(e,t)})}},34270:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const r=s(5163);r.__exportStar(s(65089),t),r.__exportStar(s(13980),t),r.__exportStar(s(16670),t),r.__exportStar(s(61928),t),r.__exportStar(s(85494),t),r.__exportStar(s(64620),t),r.__exportStar(s(77952),t),r.__exportStar(s(73175),t),r.__exportStar(s(87588),t),r.__exportStar(s(95561),t)},4238:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},73858:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const r=s(5163);r.__exportStar(s(89877),t),r.__exportStar(s(34270),t),r.__exportStar(s(4238),t),r.__exportStar(s(31796),t),r.__exportStar(s(73836),t),r.__exportStar(s(75884),t),r.__exportStar(s(25076),t),r.__exportStar(s(90294),t),r.__exportStar(s(14572),t),r.__exportStar(s(86307),t),r.__exportStar(s(98593),t),r.__exportStar(s(99540),t),r.__exportStar(s(91792),t),r.__exportStar(s(77163),t),r.__exportStar(s(80375),t),r.__exportStar(s(72288),t),r.__exportStar(s(68537),t),r.__exportStar(s(42580),t),r.__exportStar(s(98522),t),r.__exportStar(s(76893),t)},31796:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.JSONResource=void 0;const r=s(15729),n=s(14572);(0,r.enablePatches)();const i=e=>{switch(e.op){case"add":return{kind:"add",path:e.path,value:e.value};case"remove":return{kind:"remove",path:e.path};case"replace":return{kind:"replace",path:e.path,value:e.value}}};class o extends n.Resource{applyPatch(e){const t=[];(0,r.produce)(this.getLatest(),e,(e=>{t.push(...e)}));const s=()=>{for(const e of t)this.applyChange(i(e))};this.batcher.isBatching()?s():this.batcher.batchAll(s)}}t.JSONResource=o},73836:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.JsonManipulator=t.jsonWalk=void 0;const r=s(75884);t.jsonWalk=(e,t)=>{const s=e=>Array.isArray(e)?[...e]:"object"==typeof e?{...e}:e,{path:n}=t;if(0===n.length){if("remove"===t.kind)throw new Error("Cannot remove from empty path");if("add"===t.kind)throw new Error("Cannot add to empty path");if("fetch"===t.kind)return e;if("replace"===t.kind)return t.value;if("partial-string-replace"===t.kind)throw new Error("Cannot apply partial string replace to empty path");throw new Error("Not yet supported")}const i=(e,t,n)=>{if(1===t.length){const s=t[0];if("add"===n.kind){if(Array.isArray(e)&&"number"==typeof s)return[...e.slice(0,s),n.value,...e.slice(s)];{const t=e[s];return Array.isArray(t)?{...e,[s]:[...t,n.value]}:{...e,[s]:n.value}}}if("remove"===n.kind){if(Array.isArray(e)&&"number"==typeof s)return[...e.slice(0,s),...e.slice(s+1)];{const t=String(s),r={};for(const s of Object.keys(e))s!==t&&(r[s]=e[s]);return r}}if("fetch"===n.kind)return e[s];if("replace"===n.kind){const s=t[0];return Array.isArray(e)&&"number"==typeof s?[...e.slice(0,s),n.value,...e.slice(s+1)]:{...e,[s]:n.value}}if("partial-string-replace"===n.kind){const t=e[s];if("string"!=typeof t)throw new Error("Cannot apply partial string replace on non-string");const i=r.stringManipulator.reducer(t,n.partialChange).value;return Array.isArray(e)&&"number"==typeof s?[...e.slice(0,s),i,...e.slice(s+1)]:{...e,[s]:i}}return e}{const r=s(e)[t[0]];if(!r)throw new Error(`Cannot ${n.kind} : non existing path`);if("object"!=typeof r)throw new Error(`Cannot ${n.kind} : cannot change in non empty path of non object/array`);const o=t[0];if("fetch"===n.kind)return i(r,t.slice(1),n);if(Array.isArray(e)){if("number"!=typeof o)throw new Error(`Cannot ${n.kind} : cannot access array with non number index`);return[...e.slice(0,o),i(r,t.slice(1),n),...e.slice(o+1)]}return{...s(e),[t[0]]:i(r,t.slice(1),n)}}};if("object"!=typeof e||null===e)throw new Error("Cannot apply change to undefined value");return i(e,n,t)},t.JsonManipulator=class{constructor(){this.merger=(e,s,r)=>{const n=(e,s)=>{const r=[s.path||s.fromPath,s.toPath];if(void 0===r[0])return!0;try{for(const s of r)s&&(0,t.jsonWalk)(e,{path:s,kind:"fetch"});this.reducer(e,s)}catch(e){return!1}return!0},i=(e,s,r)=>{if(["add","move","copy"].includes(r.kind)){const n=r.path||r.toPath;if(n.length>0){const r=n[n.length-1],i=(0,t.jsonWalk)(e,{kind:"fetch",path:n.slice(0,-1)});if("number"==typeof r&&Array.isArray(i)){const e=[s.path||s.fromPath,s.toPath];for(const t of e)if(t){const e=t[t.length-1];"number"==typeof e&&Array.isArray(i)&&r<=e&&(t[t.length-1]+=1)}}}}if(["remove","move"].includes(r.kind)){const n=r.path||r.fromPath;if(n.length>0){const r=n[n.length-1],i=(0,t.jsonWalk)(e,{kind:"fetch",path:n.slice(0,-1)});if("number"==typeof r&&Array.isArray(i)){const e=[s.path||s.fromPath,s.toPath];for(const t of e)if(t){const e=t[t.length-1];"number"==typeof e&&Array.isArray(i)&&r<=e&&(t[t.length-1]-=1)}}}}return s},o=[],a=[];for(const t of s){let s=t;for(const n of[...r,...o])s=i(e,t,n);n(e,s)?(o.push(s),e=this.reducer(e,s).value):a.push(t)}return{changesToApply:o,changesRevoked:a}}}reducer(e,s){switch(s.kind){case"add":return{value:(0,t.jsonWalk)(e,s),invertingChanges:[{kind:"remove",path:s.path}]};case"remove":return{value:(0,t.jsonWalk)(e,s),invertingChanges:[{kind:"add",path:s.path,value:(0,t.jsonWalk)(e,{kind:"fetch",path:s.path})}]};case"move":{const r=(0,t.jsonWalk)(e,{kind:"fetch",path:s.fromPath});if(void 0===r)throw new Error("Cannot move : non existing path");const n={kind:"remove",path:s.fromPath},i={kind:"add",path:s.toPath,value:r},o=(0,t.jsonWalk)(e,{kind:"fetch",path:s.toPath});return{value:(0,t.jsonWalk)((0,t.jsonWalk)(e,n),i),invertingChanges:[{kind:"move",fromPath:s.toPath,toPath:s.fromPath},...o?[{kind:"add",path:s.toPath,value:o}]:[]]}}case"copy":{const r=(0,t.jsonWalk)(e,{kind:"fetch",path:s.fromPath});if(void 0===r)throw new Error("Cannot copy : non existing path");const n={kind:"add",path:s.toPath,value:r},i=(0,t.jsonWalk)(e,{kind:"fetch",path:s.toPath});return{value:(0,t.jsonWalk)(e,n),invertingChanges:[i?{kind:"replace",path:s.toPath,value:i}:{kind:"remove",path:s.toPath}]}}case"replace":{const r=(0,t.jsonWalk)(e,{kind:"fetch",path:s.path});return{value:(0,t.jsonWalk)(e,s),invertingChanges:[{kind:"replace",path:s.path,value:r}]}}case"partial-string-replace":return{value:(0,t.jsonWalk)(e,s),invertingChanges:[{kind:"partial-string-replace",path:s.path,partialChange:{kind:"partial",applyDiffs:s.partialChange.invertDiffs,invertDiffs:s.partialChange.applyDiffs}}]};default:throw new Error(`Unsupported change kind ${s.kind} for json manipulator`)}}squasher(e){return e.reduce(((e,t)=>{if(0!==e.length){const s=e[e.length-1];"replace"===t.kind&&"replace"===s.kind?JSON.stringify(t.path)===JSON.stringify(s.path)&&(s.value=t.value):"partial-string-replace"===t.kind&&"partial-string-replace"===s.kind?JSON.stringify(t.path)===JSON.stringify(s.path)&&(s.partialChange=r.stringManipulator.squasher([s.partialChange,t.partialChange])[0]):e.push(t)}else e.push(t);return e}),[])}}},91439:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isSameResource=t.queryManipulator=t.querySquasher=t.findPrevChange=t.squashJsonAndFull=t.queryReducer=t.isSameIdentifier=void 0;const r=s(73836);function n(e,t){return e.type===t.type&&e.serializedId===t.serializedId}t.isSameIdentifier=n;const i=new r.JsonManipulator;t.queryReducer=(e,t)=>{switch(t.kind){case"full":return{value:t.value,invertingChanges:[{kind:"full",value:e}]};case"partial":{const s=e.resources.filter((e=>!t.removed.find((t=>n(t,e)))));for(const e of t.added)s.push(e);return{value:{resources:s,metaData:e.metaData},invertingChanges:[{kind:"full",value:e}]}}case"meta":{const s={kind:"meta",changes:[]};let r=e.metaData;for(const n of t.changes)if("full"===n.kind)s.changes.unshift({kind:"full",value:r}),r=n.value;else{const t=i.reducer(e.metaData,n);r=t.value,s.changes.push(...t.invertingChanges)}return{value:{resources:e.resources,metaData:r},invertingChanges:[s]}}}},t.squashJsonAndFull=e=>{const t=e.findIndex((e=>"full"===e.kind));return-1===t?i.squasher(e):[e[t],...i.squasher(e.slice(t+1))]},t.findPrevChange=(e,t)=>{const s=e.findIndex((e=>"full"===e.kind));if(-1===s)return e.findIndex((e=>e.kind===t));const r=e.slice(s+1).findIndex((e=>e.kind===t));return-1===r?r:r+s+1},t.querySquasher=e=>e.reduce(((e,s)=>{if(0===e.length)return e.push(s),e;if("full"===s.kind)return[s];if("meta"===s.kind){const r=(0,t.findPrevChange)(e,"meta");if(-1===r)return e.push(s),e;const n=e[r];e.splice(r,1);const i=n.changes.concat(s.changes),o={kind:"meta",changes:(0,t.squashJsonAndFull)(i)};return e.push(o),e}if("partial"===s.kind){const r=(0,t.findPrevChange)(e,"partial");if(-1===r)return e.push(s),e;e.splice(r,1);const i=e[r],o=[...i.added],a=[...i.removed],c=e=>{o.find((t=>n(t,e)))||o.push(e)},u=e=>{const t=o.findIndex((t=>n(t,e)));-1!==t?o.splice(t,1):a.find((t=>n(t,e)))||a.push(e)};s.added.forEach(c),s.removed.forEach(u),e.push({kind:"partial",added:o,removed:a})}return e}),[]),t.queryManipulator={reducer:t.queryReducer,squasher:t.querySquasher},t.isSameResource=function(e,t){return e.getType()===t.getType()&&e.getSerializedId()===t.getSerializedId()}},75884:(e,t)=>{function s(e){const t=[],s=e.map((e=>typeof e));for(let r=0;r<e.length-1;r++){const n=t[t.length-1];if("number"===s[r])if("number"===s[r+1])if(e[r]+1===e[r+1])"object"==typeof n&&2===n.length&&e[r]===n[1]?n[1]=e[r+1]:t.push([e[r],e[r+1]]);else if("object"==typeof n&&2===n.length){if(n[1]===e[r])continue;t.push([e[r],e[r]])}else t.push(e[r]);else if("object"==typeof n&&2===n.length){if(n[1]===e[r])continue;t.push([e[r],e[r]])}else t.push(e[r]);else t.push(e[r])}return t.push(e[e.length-1]),t}function r(e){const t=[];for(const s of e)if("object"==typeof s&&2===s.length)for(let e=s[0];e<=s[1];e++)t.push(e);else t.push(s);return t}Object.defineProperty(t,"__esModule",{value:!0}),t.stringManipulatorWithId=t.stringManipulator=t.parseChangeMetadata=t.getDeltaFromPartialChange=t.stringPartialChange=t.stringPartialChangeByValues=t.getChangeRanges=void 0,t.getChangeRanges=function(e){const s=o(e)[0];return"full"===s.kind?[{from:0,length:s.value.length,newLength:s.value.length}]:"partial"===s.kind?(0,t.parseChangeMetadata)(s,"").replacements.map((e=>({from:e.from,length:e.length,newLength:e.newLength}))):[{from:0,length:0,newLength:0}]},t.stringPartialChangeByValues=(e,t,r,n)=>{if(e===t)return;const i=Array.from(Array(r).keys()),o=n-r-t.length,a=[...i,...t.split(""),[o]],c=[...i,...e.split(""),[-o]];for(let e=0;e<a.length;e++)"string"==typeof a[e]&&"string"==typeof c[e]&&a[e]===c[e]&&(a[e]=e,c[e]=e);return{kind:"partial",applyDiffs:s(a),invertDiffs:s(c)}},t.stringPartialChange=(e,s,r,n)=>(0,t.stringPartialChangeByValues)(n.getLatest().slice(s,r),e,s,r),t.getDeltaFromPartialChange=e=>e.applyDiffs[e.applyDiffs.length-1][0];const n=(e,t)=>{switch(t.kind){case"full":return{value:t.value,invertingChanges:[{kind:"full",value:e}]};case"partial":{let s="";for(const n of r(t.applyDiffs))s+="number"==typeof n?e[n]:"string"==typeof n?n:e.slice(s.length+n[0]);return{value:s,invertingChanges:[{kind:"partial",applyDiffs:t.invertDiffs,invertDiffs:t.applyDiffs}]}}}};t.parseChangeMetadata=(e,t)=>{const s=[];let i=!1,o=-1,a=0;const c=r(e.applyDiffs),u=r(e.invertDiffs);for(const e of c)if("number"!=typeof e)if("string"==typeof e)i?s[s.length-1].newLength+=1:(i=!0,s.push({from:o+1,length:1,newLength:1}));else if(a=s.map((e=>e.newLength-e.length)).reduce(((e,t)=>e+t),0),i){if(s.length>0){const t=s[s.length-1];t.length=c.length-t.from-1+e[0]}}else{const t=e[0];t>0?s.push({from:o+1,length:t+a,newLength:0}):t<0&&t-a>0&&s.push({from:o+1,length:0,newLength:t-a})}else if(i||e===o+1||(i=!0,s.push({from:o+1,length:e-o-1,newLength:0})),o=e,i&&s.length>0){const t=s[s.length-1];t.length=e-t.from,t.newLength+=1}0===s.length&&s.push({from:c.length-1,length:1,newLength:1});const h=s[0].from,d=s[s.length-1].from+s[s.length-1].length;void 0===t&&(t=u.slice(h,d).join(""));const p=n(t,e).value,l=[];let g=0;for(const e of s)l.push({oldText:t.slice(e.from,e.from+e.length),newText:p.slice(e.from+g,e.from+g+e.newLength),from:e.from,length:e.length,newLength:e.newLength}),g+=e.newLength-e.length;return{from:h,to:d,replacements:l,oldText:t,newText:p}};const i=(e,t,n)=>{const i=[];let o=0;"partial"===e.kind&&(o=e[n][e[n].length-1][0]);let a=[];if("partial"!==t.kind)throw new Error("Cannot unpack non partial diff");for(const s of r(t[n]))if("string"==typeof s)i.push(s);else if("number"==typeof s){const t=s;if("full"===e.kind)t<e.value.length&&i.push(e.value[t]);else if("partial"===e.kind)if(a=a.length?a:r(e[n]),t<a.length)if("object"!=typeof a[t])i.push(a[t]);else{const e=a[t][0];i.push(t+e)}else i.push(t+o)}else if("object"==typeof s){const t=s[0];if("full"===e.kind){const t=i.length;t<e.value.length&&i.push(e.value[t])}else if("partial"===e.kind){a=a.length?a:r(e[n]);for(let e=i.length+t;e<a.length;e++)"object"!=typeof a[e]&&i.push(a[e]);i.push([t+o])}break}return s(i)},o=e=>e.length<=1?e:[e.reduce(((e,t)=>{if("full"===t.kind)return{kind:"full",value:t.value};if("full"===e.kind)return{kind:"full",value:n(e.value,t).value};{const s={kind:"partial",applyDiffs:[],invertDiffs:[]};return s.applyDiffs=i(e,t,"applyDiffs"),s.invertDiffs=i(t,e,"invertDiffs"),s}}))].filter((e=>{if("partial"!==e.kind)return!0;{const t=e.applyDiffs[e.applyDiffs.length-1][0],s=e.applyDiffs.map((e=>typeof e));return 0!==t||s.includes("string")}})),a=(e,t,n)=>{const i={};for(const e of t){if("partial"!==e.kind)return{changesToApply:[],changesRevoked:n};{const t=r(e.applyDiffs);let s=0,n=0;for(const[e,r]of t.entries())if("number"==typeof r){if(r!==e){const t=e-r-s;0!==t&&(i[e]||(i[e]=0),i[e]+=t,s+=t)}}else if("object"==typeof r){const t=-r[0]-s;if(0!==t){const r=e-n;i[r]||(i[r]=0),i[r]+=t,s+=t}}else"string"==typeof r?n+=1:n=0}}if(0!==n.filter((e=>"full"===e.kind)).length)return{changesToApply:n,changesRevoked:[]};const o=e=>{let t=0,s=0,r=0,n=e.map((e=>Array.isArray(e)?[e[0]]:e));for(;t<n.length;){const e=n[t];if(i[t]?s+=i[t]:"number"==typeof e&&i[e]?s+=i[e]:"object"==typeof e&&i[t+e[0]]&&(s+=i[t+e[0]]),s>0){const i=[];if("string"==typeof e&&t>0&&"string"==typeof n[t-1]){t++;continue}for(let r=t;r<t+s;r++)("object"!=typeof e||e[0]>0)&&i.push(r);r+=s,s=0,"number"==typeof e?0!==r&&i.push(e+r):i.push(e),n=[...n.slice(0,t),...i,...n.slice(t+1)],t+=i.length-1}else s<0?(s+=1,r-=1,"number"==typeof e&&0!==r&&(n[t]+=r)):"number"==typeof e&&0!==r&&(n[t]+=r);t++}return n},a=[];for(const e of n){const t=o(r(e.applyDiffs)).filter((e=>-1!==e)),n=o(r(e.invertDiffs)).filter((e=>-1!==e));a.push({kind:"partial",applyDiffs:s(t),invertDiffs:s(n)})}return{changesToApply:a,changesRevoked:[]}};t.stringManipulator={reducer:n,squasher:o,merger:a},t.stringManipulatorWithId=()=>({reducer:n,squasher:o,merger:a})},25076:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PluggableResource=t.ResourceField=t.PluggableResourceEntryDefinition=t.defaultMergeConfig=void 0;const r=s(93849),n=s(14572);t.defaultMergeConfig=(e,t)=>e&&e.constructor===Object?{...e,...t}:t||e;class i extends r.FeatureInput{constructor(e,t,s){super(r.AllEnvironments,r.AllEnvironments),this.customKey=e,this.defaultValue=t,this.mergeConfig=s,this.defaultValue=t}getTypeName(){return this.typeName}[r.IDENTIFY_API](e,t){if(this.customKey)this.typeName=this.customKey;else{const s=((e,t)=>`${e}.${t}`)(e,t);this.typeName=s}}[r.CREATE_RUNTIME](e,t,s){const r=e.getTopLevelConfig(t,s).reduce(((e,t)=>this.mergeConfig(e,t)),this.defaultValue);return new o(this.typeName,r,this.mergeConfig)}[r.REGISTER_VALUE](e,t,s){return s}}t.PluggableResourceEntryDefinition=i;class o{constructor(e,t,s){this.key=e,this.defaults=t,this.mergeConfig=s}}t.ResourceField=o;class a extends n.Resource{get(e){if(this.isDisposed())return;const t=e.defaults,s=this.getLatest()[e.key];return t&&t.constructor===Object?e.mergeConfig(t,s):s||t}merge(e,t){this.getLatest()[e.key]?this.batcher.batchAll((()=>{for(const s of Object.keys(t))this.applyChange({kind:"add",value:t[s],path:[e.key,s]})})):this.applyChange({kind:"add",value:t,path:[e.key]})}}t.PluggableResource=a},90294:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.QueryResource=void 0;const r=s(14572),n=s(91439),i=s(86307);class o extends r.Resource{constructor(e,t){super(e,{batcher:t.batcher,manipulator:n.queryManipulator,provider:t.provider,resourceType:t.resourceType}),this.results=new Set,this.disposedResults=new Set,this.updatedResults=new Set,this.snap=this.createSnapshot()}getResults(){return new Set([...this.results])}getResult(e,t){return this.findResourceInSet(this.results,{id:t,type:e.getTypeName(),serializedId:(0,i.serializeId)(t)})||null}getMetaData(){return this.getLatest().metaData}setResults(e,t,s,r=!1){for(const e of t)this.disposedResults.add(e);for(const e of s)this.updatedResults.add(e);this.results=e,r&&this.dispatchEvent({id:this.getId(),serializedId:this.getSerializedId()})}dispatchEvent(e){const t=this.snap;this.snap=this.createSnapshot();const s=this.getChangesFromVersion(t),r=new Set,n=new Set,i=this.updatedResults;for(const e of s)switch(e.kind){case"full":break;case"partial":for(const t of e.added){const e=this.findResourceInSet(this.results,t);e&&r.add(e)}for(const t of e.removed){const e=this.findResourceInSet(this.disposedResults,t);e&&n.add(e)}}this.updatedResults=new Set,this.disposedResults=new Set,(r.size||n.size||i.size)&&super.dispatchEvent({added:r,removed:n,changed:i,...e})}findResourceInSet(e,{type:t,serializedId:s}){return[...e].find((e=>e.getType()===t&&e.getSerializedId()===s))}}t.QueryResource=o},86307:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ResourceManager=t.deserializeId=t.serializeId=void 0;const r=s(5163),n=s(98522),i=s(91570),o=r.__importDefault(s(72321)),a=s(76893);function c(e){return JSON.stringify(e,Object.keys(e).sort())}function u(e){return JSON.parse(e)}t.serializeId=c,t.deserializeId=u,t.ResourceManager=class{constructor(e,t,s,r,n,a=t,u=[]){this.strategy=e,this.typeName=t,this.syncer=s,this.batcher=r,this.logger=n,this.baseTypeName=a,this.dependenciesBaseTypeName=u,this.listeners=new Set,this.inBatchlisteners=new Set,this.listListeners=new Set,this.openResources={},this.serializeIdsCache=new Map,this.syncerAPI={dispatchChanges:(e,t)=>{const s=new Set(Array.from(e).map((e=>this.openResources[e]))),r=new Set(Array.from(t).map((e=>this.openResources[e])));for(const e of this.inBatchlisteners)e(s,r)},get:(e,t)=>this.get(e,t),getResource:e=>this.openResources[this.cachedSerializeId(e)],getOpen:()=>this.getOpenResources(),isOpen:e=>this.isOpen(e),onDependencyChange:e=>{if(!this.strategy.onDependencyChange)return{recomputedVal:[],recomputedStatus:[]};const t=this.getOpenResources().reduce(((e,t)=>(e[t]=this.openResources[t],e)),{});return this.strategy.onDependencyChange(t,e)},hasComputeBack:()=>void 0!==this.strategy.onComputeBack,onComputeBack:e=>{if(this.strategy.onComputeBack)return this.strategy.onComputeBack(e)},hasComputeBackValidate:()=>!!this.strategy.hasComputeBackValidate&&this.strategy.hasComputeBackValidate(),onComputeBackValidate:e=>this.strategy.onComputeBackValidate(e),hasDependenciesToSync:()=>!!this.strategy.dependenciesToSync,dependenciesToSync:e=>this.strategy.dependenciesToSync(e),getMasterSyncerId:()=>this.strategy.getMasterSyncerId(),isLocalChangeAllowed:()=>this.strategy.isLocalChangeAllowed(),remoteInitializeResource:(e,t)=>this.remoteInitializeResource(e,t),onRemoteChanges:(e,t,s,r)=>this.strategy.onRemoteChanges(e,t,s,r),subscribeToOpen:e=>this.subscribeToOpened(e),resourceManager:this},this.isOpen=e=>!!this.openResources[this.cachedSerializeId(e)],this.isProviderOpen=async e=>{if(this.isOpen(e))return!0;const t=this.strategy.getMasterSyncerId();return t!==this.syncer.id&&await this.syncer.isRemoteOpen(this.typeName,e,t)},this.remoteInitializeResource=(e,t)=>{const s=this.strategy.remoteInitializeResource(e,t);return this.onResourceCreated(s).catch(i.reportError),s},this.createResource=(e,t)=>{o.default.mark("createResource");const s=this.strategy.createResource(e);return t&&s.use(t),this.openResources[this.cachedSerializeId(e)]=s,this.onResourceCreated(s).catch(i.reportError),s},this.onResourceCreated=async e=>{this.openResources[e.getSerializedId()]=e,e.subscribeToDispose(this.disposeResource),e.isReady()||await e.ready,this.dispatchOpenListEvent([e.getSerializedId()])},this.dispatchOpenListEvent=(e=[],t=[])=>{for(const s of this.listListeners)s(e,t)},this.disposeResource=e=>{this.dispatchOpenListEvent([],[e.getSerializedId()]),delete this.openResources[e.getSerializedId()]},this.cachedSerializeId=e=>{const t=this.serializeIdsCache.get(e);if(t)return t;{const t=c(e);return this.serializeIdsCache.set(e,t),t}},this.batcherListerer=e=>{if(e.changed[this.getTypeName()]||e.changedStatus[this.getTypeName()]){const t=this.getResources(e.changed[this.getTypeName()]),s=this.getResources(e.changedStatus[this.getTypeName()]);this.listeners.forEach((e=>e(t,s)))}};const h=this.strategy.getManipulator();s.registerResourceType(t,{manipulator:h,resourceManager:this.getSyncerAPI(),baseTypeName:a,dependenciesBaseTypeName:u})}addDependencyResourceManager(e){this.syncer.addResourceDependency(this,e)}getSyncerAPI(){return this.syncerAPI}getTypeName(){return this.typeName}isResourceOfType(e){return e.getType()===this.getTypeName()}getBatcher(){return this.batcher}get(e,t){let s;return this.isOpen(e)?(s=this.openResources[this.cachedSerializeId(e)],t&&s.use(t)):s=this.createResource(e,t),s}getIfReady(e){const t=this.openResources[this.cachedSerializeId(e)];if(t&&t.isReady())return t}async getReady(e,t){const s=this.get(e,t);return await s.ready,s}getOpenResources(){return Object.keys(this.openResources)}reEvaluateValue(e){const t=this.openResources[this.cachedSerializeId(e)];if(t){if(!this.strategy.getValueFromHandler)throw new Error("type strategy does not support invalidation");const s=this.strategy.getValueFromHandler(e,t);(0,a.isPromise)(s)?s.then((e=>{t.isDisposed()||this.setResourceValue(t,e)})).catch(i.reportError):this.setResourceValue(t,s)}}setResourceValue(e,t){const s=e.getLatest();t.value!==s&&(e.applyChange((0,n.fullChange)(t.value)),e.setStatus(t.status||{valid:!0}))}subscribeToAny(e){this.subscribeToBatcher(),this.listeners.add(e)}unsubscribeFromAny(e){this.listeners.delete(e)}subscribeToOpened(e){this.listListeners.add(e)}unsubscribeToOpened(e){this.listListeners.delete(e)}subscribeDuringBatch(e){this.inBatchlisteners.add(e)}unsubscribeDuringBatch(e){this.inBatchlisteners.delete(e)}subscribeToBatcher(){this.batcher.subscribe(this.batcherListerer)}getResources(e){return new Set((null==e?void 0:e.map((e=>this.get(u(e)))))||[])}}},14572:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Resource=t.ResourceSnapshot=void 0;const r=s(98522),n=s(76893),i=s(86307),o=s(91570);class a{constructor(e,t){this.ofVer=e,this.disposer=t,this.disposed=!1}dispose(){this.disposer(this),this.disposed=!0}isDisposed(){return this.disposed}}t.ResourceSnapshot=a,t.Resource=class{constructor(e,t,s){this.id=e,this.validateChange=s,this.ready=void 0,this.subscribers=new Set,this.disposeSubscribers=new Set,this.status={valid:!0},this.disposed=!1,this.base=void 0,this.changes=[],this.invertingChanges=[],this.projections={},this.snaps=new Set,this.lastProjection=void 0,this.batchStart=void 0,this._ready=!1,this.disposeSnap=e=>{if(!this.snaps.has(e))throw(0,n.unknownVersionError)(e.ofVer,this.getSerializedId(),this.currentVersion);this.snaps.delete(e);const t=e.ofVer,s=[...this.snaps];s.find((e=>e.ofVer===t))||delete this.projections[t];const i=s.reduce(((e,t)=>Math.min(e,t.ofVer)),Number.MAX_SAFE_INTEGER),o=this.changes.findIndex((e=>e.version>i));if(o>0){const e=this.changes.splice(0,o),t=(e,t)=>{let s=e;for(const e of t)if((0,r.isFullChange)(e))s=e.value;else{const{value:t}=this.manipulator.reducer(s,e);s=t}return s};this.base={value:t(this.base.value,e.map((e=>e.change))),version:i}}},this.serializedId=(0,i.serializeId)(e),this.users=new Set,this.provider=t.provider,this.manipulator=t.manipulator||n.fullChangeManipulator,this.batcher=t.batcher,this.resourceTypeId=t.resourceType,this.currentVersion=r.FIRST_VERSION,this.provider.dispose&&this.disposeSubscribers.add(this.provider.dispose);try{const t=this.provider.provide(e,this);(0,n.isPromise)(t)?(this.ready=new Promise(((e,t)=>{this._resolveReady=e})),t.then((e=>{this.base={value:e.value,version:r.FIRST_VERSION},this.status=e.status||{valid:!0},this.triggerDisposeCheck(),this._ready=!0,this.ready=void 0,this._resolveReady(e.value)})).catch((e=>{console.error(e),this.invalidate(`Provider of resource type ${this.getType()} and id ${this.getSerializedId()} failed to provide value, reason: ${e}`),this.base=void 0,this._ready=!0,this.ready=void 0,this._resolveReady(void 0)}))):(this._ready=!0,this.base={value:t.value,version:r.FIRST_VERSION},this.status=t.status||{valid:!0})}catch(e){console.error(e),this.invalidate(`Provider of resource type ${this.getType()} id ${this.getSerializedId()} failed to provide value, error: ${e}`),this.base=void 0,this._ready=!0,this.ready=void 0}}getType(){return this.resourceTypeId}getId(){return this.id}getSerializedId(){return this.serializedId}getManipulator(){return this.manipulator}getCurrentVersion(){return this.currentVersion}isChanged(){return this.currentVersion!==r.FIRST_VERSION}getBatcher(){return this.batcher}createSnapshot(){const e=new a(this.currentVersion,this.disposeSnap);return this.snaps.add(e),this.projections[this.currentVersion]||(this.isReady()?this.projections[this.currentVersion]=this.isValid()?this.getLatest():void 0:this.ready.then((()=>{this.snaps.size&&(this.projections[this.currentVersion]=this.isValid()?this.getLatest():void 0)})).catch(o.reportError)),e}isReady(){return this._ready}applyChange(e,t=!1){var s;return null===(s=this.validateChange)||void 0===s||s.call(this,e),this.applyChangeInternal(e,t)}applyChangeInternal(e,t=!1){if(this.disposed&&!t)throw(0,n.disposedResourceError)(this.getType(),this.getSerializedId());if(!this.status.valid&&!t)throw(0,n.invalidResourceError)(this.getType(),this.getSerializedId(),this.getInvalidationMessage());if(!this.isReady()&&!t)throw(0,n.nonReadyResourceError)(this.getType(),this.getSerializedId());const s=void 0!==this.lastProjection?this.lastProjection:this.base.value,r=()=>{if(this.batcher.inAtomic){this.batcher.registerForBatch(this,this.getSerializedId(),this.resourceTypeId,!1);const e=this.getType(),t=this.getSerializedId();this.batcher.getAtomicSnapshot(e,t)||this.batcher.setAtomicSnapshot(e,t,this.createSnapshot())}this.batchStart||(this.batchStart=this.createSnapshot());const t=this.applyChanges(s,[e]),r=this.wrapWithVersion(this.changes,e)[0];this.currentVersion=r.version,this.changes.push(r),this.lastProjection=t,this.dispatchOrPend(!1)};if(void 0!==this.batcher.getRunningBatchId()&&this.batcher.isBatching())r();else{const e=this.batcher.runAtomic(r);if("failure"===e.status)throw e.error}}subscribe(e){this.subscribers.add(e)}subscribeToDispose(e){this.disposeSubscribers.add(e)}subscribeOnce(e){const t=s=>{this.subscribers.delete(t),e(s)};this.subscribers.add(t)}unsubscribe(e,t=!0){this.subscribers.delete(e),t&&this.triggerDisposeCheck()}unsubscribeAll(e=!0){this.subscribers=new Set([]),e&&this.triggerDisposeCheck()}async waitForValid(){if(!this.isValid()){const e=new Promise((e=>{const t=()=>{this.isValid()?e():this.subscribeOnce(t)};this.subscribeOnce(t)}));await e}}getProjection(e){return this.getProjectionInternal(e.ofVer)}getChangesBetweenVersion(e,t){return void 0===e?[]:this.getChangesBetweenVersionInternal(e.ofVer,t.ofVer)}getChangesFromVersion(e){return this.getChangesBetweenVersionInternal(e.ofVer,this.currentVersion)}getInvertingChangesBetweenVersion(e,t){return void 0===e?[]:this.getInvertingChangesBetweenVersionInternal(e.ofVer,t.ofVer).slice().reverse()}getInvertingChangesFromVersion(e){return this.getInvertingChangesBetweenVersionInternal(e.ofVer,this.currentVersion).slice().reverse()}getLatest(){const e=this.lastProjection;if(void 0!==e)return e;if(void 0!==this.base)return this.base.value;if(!this.isValid())throw this.getInvalidationMessage();throw(0,n.unknownResourceError)(this.getType(),this.getSerializedId())}getSavedChangeCount(){return this.changes.length}getSnapsCount(){return this.snaps.size}isDisposed(){return this.disposed}use(e){this.users.add(e)}release(e,t=!0){this.users.delete(e),t&&this.triggerDisposeCheck()}commit(e){this.clearBatchStart(),this.dispatchEvent({batchId:e})}revert(){if(this.batchStart){const e=this.getProjectionInternal(this.batchStart.ofVer);this.changes=this.changes.slice(0,this.changes.findIndex((e=>e.version===this.batchStart.ofVer))+1),this.lastProjection=e,this.currentVersion=this.batchStart.ofVer,this.clearBatchStart()}}clearBatchStart(){this.batchStart&&(this.batchStart.dispose(),this.batchStart=void 0)}onResourceDisposed(){}invalidate(e){this.setStatus({valid:!1,message:e})}restore(){this.setStatus({valid:!0})}isValid(){return this.getStatus().valid}getInvalidationMessage(){return this.getStatus().message}setStatus(e){return(e.valid!==this.status.valid||e.message!==this.status.message)&&(this.status=e,void 0!==this.batcher.getRunningBatchId()&&this.batcher.isBatching()?this.dispatchOrPend(!0):this.batcher.batchAll((()=>{this.dispatchOrPend(!0)})),!0)}getStatus(){return this.status}revertChanges(e){const t=[(0,r.fullChange)(this.base.value),...this.changes.slice(0,this.changes.length-e.length).map((e=>e.change))],s=this.getManipulator(),n=s.squasher?s.squasher(t):t;for(const e of n)this.applyChange(e);return 0!=n.length}dispatchEvent(e){let t={serializedId:this.serializedId,id:this.id};e&&(t={...e,...t});for(const e of this.subscribers)e(t)}dispose(){this.subscribers=new Set,this.disposed=!0,this.batcher&&this.batcher.unregisterFromBatch(this,this.getSerializedId(),this.resourceTypeId);for(const e of this.disposeSubscribers)e(this);this.base=void 0,this.changes=[],this.invertingChanges=[]}triggerDisposeCheck(){setTimeout((e=>e.disposeIfUnused()),10,this)}disposeIfUnused(){this.isDisposed()||0!==this.users.size||0!==this.subscribers.size||this.dispose()}getAnyChangesBetweenVersionInternal(e,t,s){if(t>=s)return[];const i=t===r.FIRST_VERSION?0:e.findIndex((e=>e.version===t))+1,o=e.findIndex((e=>e.version===s))+1;if(-1===o)throw(0,n.unknownVersionError)(s,this.getSerializedId(),this.currentVersion);if(-1===i)throw(0,n.unknownVersionError)(s,this.getSerializedId(),t);return e.slice(i,o).map((e=>e.change))}getChangesBetweenVersionInternal(e,t){return this.getAnyChangesBetweenVersionInternal(this.changes,e,t)}getInvertingChangesBetweenVersionInternal(e,t){return this.getAnyChangesBetweenVersionInternal(this.invertingChanges,e,t)}getProjectionInternal(e){return this.projections[e]}dispatchOrPend(e){this.batcher&&this.batcher.isBatching()?this.batcher.registerForBatch(this,this.getSerializedId(),this.resourceTypeId,e):this.dispatchEvent()}wrapWithVersion(e,...t){let s=e.length?e[e.length-1].version:this.currentVersion;return t.map((e=>(s++,{change:e,version:s})))}applyChanges(e,t){let s=e;for(const e of t)if((0,r.isFullChange)(e)){const t=s;s=e.value,this.invertingChanges.push(...this.wrapWithVersion(this.invertingChanges,(0,r.fullChange)(t)))}else{const{value:t,invertingChanges:r}=this.manipulator.reducer(s,e);s=t,this.invertingChanges.push(...this.wrapWithVersion(this.invertingChanges,...r))}return s}}},98593:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.OneWayComputedStrategy=t.OneWayComputedStrategyMaster=void 0;const r=s(14572),n=s(76893),i=s(91792);class o{constructor(e,t,s,r,n,i){this.resourceClass=e,this.envId=t,this.type=s,this.batcher=r,this.manipulator=n,this.handler=i,this.dependencies={},this.snaps={},this.dependencyTypes=new Set}getResourceDependenciesType(){return this.dependencyTypes}getManipulator(){return this.manipulator}createResource(e){const t={provide:(e,t)=>{const s=e=>{for(const s of e.dependencies)s.use(t);return this.updateDependencies(t,e.dependencies),e},r=this.safeCompute(e,t);return(0,n.isPromise)(r)?r.then(s):s(r)},dispose:e=>{this.handler.dispose&&this.handler.dispose(e),this.onResourceDisposed(e)}},s=new this.resourceClass(e,{batcher:this.batcher,provider:t,manipulator:this.manipulator,resourceType:this.type});if(s.isReady()){const e=this.dependencies[s.getSerializedId()]||[];this.updateSnapshots([s,...e])}else s.ready.then((()=>{const e=this.dependencies[s.getSerializedId()]||[];this.updateSnapshots([s,...e])})).catch((e=>(0,n.reportResourceError)(s," initialization ",e)));return s}remoteInitializeResource(){throw new Error("one way computed master cannot be remote initialized")}getValueFromHandler(e,t){return this.safeCompute(e,t)}onRemoteChanges(e,t,s){return{status:"failure",statusChanged:!!t.newStatus&&s.setStatus(t.newStatus),reason:"OneWayComputedStrategyMaster does not allow remote changes from "+e}}isLocalChangeAllowed(){return!0}getMasterSyncerId(){return this.envId}onResourceDisposed(e){const t=e.getSerializedId();if(this.dependencies[t]){for(const s of this.dependencies[t])s.release(e);delete this.dependencies[t]}}onDependencyChange(e,t){const s=Object.keys(t),r=this.getResourceDependenciesType();if(!s.find((e=>r.has(e))))return{recomputedVal:[],recomputedStatus:[]};const i=[],o=[],a=new Set,c=Object.keys(e);for(const s of c){const r=this.dependencies[s];if(r){const c=new Set([...r].filter((e=>t[e.getType()]&&t[e.getType()].includes(e.getSerializedId()))));if(c.size){const t=e[s];a.add(t),c.forEach((e=>a.add(e)));const r=e=>{this.updateDependencies(t,e.dependencies);for(const s of e.changes)t.applyChange(s,!0);const s=t.setStatus(e.status);return{changedVal:e.changes.length,changedStatus:s}},u=this.recomputeResource(t,c);try{if((0,n.isPromise)(u))u.then(r).catch((e=>{(0,n.reportResourceError)(t," recompute ",e),t.invalidate(e.message)}));else{const e=r(u);e.changedVal&&i.push(s),e.changedStatus&&o.push(s)}}catch(e){(0,n.reportResourceError)(t," recompute ",e),t.invalidate(e.message)}}}}return this.updateSnapshots([...a]),{recomputedVal:i,recomputedStatus:o}}recomputeResource(e,t){const s=e.getSerializedId(),r=this.dependencies[s];try{const s=this.handler.recompute(e,this.snaps,t,r);return(0,n.isPromise)(s)?s.catch((t=>((0,n.reportResourceError)(e," recompute ",t),{changes:[],status:{valid:!1,message:t.message},dependencies:r}))):s}catch(t){return(0,n.reportResourceError)(e," recompute ",t),{changes:[],status:{valid:!1,message:t.message},dependencies:r}}}updateDependencies(e,t){const s=this.dependencies[e.getSerializedId()];if(s!==t)if(this.dependencies[e.getSerializedId()]=t,s){for(const r of s)t.has(r)||r.release(e);for(const r of t)s.has(r)||(r.use(e),this.dependencyTypes.add(r.getType()),this.updateSnapshots([r]))}else for(const s of t)s.use(e),this.dependencyTypes.add(s.getType())}updateSnapshots(e){for(const t of e){const e=t.getType();this.snaps[e]||(this.snaps[e]={});const s=t.getSerializedId();this.snaps[e][s]&&this.snaps[e][s].dispose(),this.snaps[e][s]=t.createSnapshot()}}safeCompute(e,t){try{const s=this.handler.compute(e,t);return(0,n.isPromise)(s)?s.catch((e=>((0,n.reportResourceError)(t," safe compute ",e),{value:void 0,status:{valid:!1,message:e.message},dependencies:new Set}))):s}catch(e){return(0,n.reportResourceError)(t," safe compute ",e),{value:void 0,status:{valid:!1,message:e.message},dependencies:new Set}}}}t.OneWayComputedStrategyMaster=o,t.OneWayComputedStrategy=function(e){return(t,s,n)=>{const a=e.customResourceClass||r.Resource,c="string"==typeof e.sourceEnv?e.sourceEnv:e.sourceEnv.env;return s.id===c?new o(a,c,t,n,e.manipulator,e.handler):new i.OneWayStrategySlave(a,c,t,n,e.manipulator,s.subscribeToRemote)}}},99540:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.OneWayIncrementalComputedStrategy=t.OneWayIncrementalComputedStrategyMaster=void 0;const r=s(14572),n=s(76893),i=s(91792),o=s(73836);class a{constructor(e,t,s,r,i,o,a,c=(()=>Date.now())){this.resourceClass=e,this.envId=t,this.type=s,this.batcher=r,this.manipulator=i,this.handler=o,this.options=a,this._timer=c,this.dependencies={},this.snaps={},this.tasks={},this.fullTasks={},this.timeouts={},this.resources={},this.changesFromBuffer={},this.dependencyTypes=new Set,this.addChangesToBuffer=e=>{for(const[t,s]of Object.entries(e)){this.changesFromBuffer[t]||(this.changesFromBuffer[t]=[]);for(const e of s)this.changesFromBuffer[t].includes(e)||this.changesFromBuffer[t].push(e)}},this.onBufferEnd=()=>{const e=[],t=[],s=new Set,r=this.changesFromBuffer;this.changesFromBuffer={};const i=this.resources,o=Object.keys(i);for(const a of o){const o=this.dependencies[a];if(o){const c=new Set([...o].filter((e=>r[e.getType()]&&r[e.getType()].includes(e.getSerializedId()))));if(c.size){const r=i[a];s.add(r),c.forEach((e=>s.add(e)));const o=s=>{for(const e of s.changes)r.applyChange(e,!0);const n=r.setStatus(s.status||{valid:!0});return s.changes.length&&e.push(a),n&&t.push(a),{changedVal:s.changes.length,changedStatus:n}},u=e=>{this.updateDependencies(r,e.dependencies);const t=this.performCompute(r,this.snaps,e.tasks);return(0,n.isPromise)(t)?t.then(o):o(t)};this.timeouts[r.getSerializedId()]&&(clearInterval(this.timeouts[r.getSerializedId()]),this.timeouts[r.getSerializedId()]=void 0);const h=this.recomputeResourceTasks(r,c);try{if((0,n.isPromise)(h))h.then(u).catch((e=>{(0,n.reportResourceError)(r," recompute ",e),r.invalidate(e.message)}));else{const e=u(h);(0,n.isPromise)(e)&&e.catch((e=>{(0,n.reportResourceError)(r," recompute ",e),r.invalidate(e.message)}))}}catch(e){(0,n.reportResourceError)(r," recompute ",e),r.invalidate(e.message)}}}}this.updateSnapshots([...s])},this.provider={provide:(e,t)=>{const s=e=>{for(const s of e.dependencies)s.use(t);this.updateDependencies(t,e.dependencies),this.onTasksComputed(t,e.tasks);const s=this.performCompute(t,{},e.tasks),r=e=>{const t=e.changes;let s=this.options.startValue;0===t.length&&(s=this.options.emptyValue);for(const e of t)s=this.manipulator.reducer(s,e).value;return{value:s,status:e.status}};return(0,n.isPromise)(s)?s.then(r):r(s)},r=this.computeTasks(e,t);return(0,n.isPromise)(r)?r.then(s):s(r)},dispose:e=>{this.handler.dispose&&this.handler.dispose(e),this.onResourceDisposed(e)}}}getResourceDependenciesType(){return this.dependencyTypes}getManipulator(){return this.manipulator}createResource(e){const t=new this.resourceClass(e,{batcher:this.batcher,provider:this.provider,manipulator:this.manipulator,resourceType:this.type}),s=this.dependencies[t.getSerializedId()]||[];return t.isReady()?this.updateSnapshots([t,...s]):t.ready.then((()=>{this.updateSnapshots([t,...s])})).catch((e=>(0,n.reportResourceError)(t," initialization ",e))),t}remoteInitializeResource(){throw new Error("one way computed master cannot be remote initialized")}getValueFromHandler(e,t){return this.provider.provide(e,t)}onRemoteChanges(e,t,s){return{status:"failure",statusChanged:!!t.newStatus&&s.setStatus(t.newStatus),reason:"OneWayComputedStrategyMaster does not allow remote changes from "+e}}isLocalChangeAllowed(){return!0}getMasterSyncerId(){return this.envId}onResourceDisposed(e){const t=e.getSerializedId();if(this.timeouts[t]&&(clearTimeout(this.timeouts[t]),this.timeouts[t]=void 0),this.dependencies[t]){for(const s of this.dependencies[t])s.release(e);delete this.dependencies[t]}}onDependencyChange(e,t){const s=Object.keys(t),r=this.getResourceDependenciesType();return s.find((e=>r.has(e)))?(this.bufferTimeout&&clearTimeout(this.bufferTimeout),this.addChangesToBuffer(t),this.resources=e,this.bufferTimeout=setTimeout(this.onBufferEnd,this.options.changeBufferTime),{recomputedVal:[],recomputedStatus:[]}):{recomputedVal:[],recomputedStatus:[]}}recomputeResourceTasks(e,t){const s=e.getSerializedId(),r=this.dependencies[s];try{const s=this.handler.updateTasks(e,this.snaps,t,r,this.getTasks(e));return(0,n.isPromise)(s)?s.then((t=>(this.onTasksComputed(e,t.tasks),t))).catch((t=>((0,n.reportResourceError)(e," recompute ",t),{tasks:[],status:{valid:!1,message:t.message},dependencies:r}))):(this.onTasksComputed(e,s.tasks),s)}catch(t){return(0,n.reportResourceError)(e," recomputeResourceTasks ",t),{tasks:[],status:{valid:!1,message:t.message},dependencies:r}}}getTasks(e){const t=e.getSerializedId();return this.tasks[t]||[]}onTasksComputed(e,t){const s=e.getSerializedId();this.tasks[s]=t,this.fullTasks[s]=t}updateDependencies(e,t){const s=this.dependencies[e.getSerializedId()];if(s!==t)if(this.dependencies[e.getSerializedId()]=t,s){for(const r of s)t.has(r)||r.release(e);for(const r of t)s.has(r)||(r.use(e),this.dependencyTypes.add(r.getType())),this.updateSnapshots([r])}else for(const s of t)s.use(e),this.dependencyTypes.add(s.getType()),this.updateSnapshots([s])}updateSnapshots(e){for(const t of e){const e=t.getType();this.snaps[e]||(this.snaps[e]={});const s=t.getSerializedId();this.snaps[e][s]&&this.snaps[e][s].dispose(),this.snaps[e][s]=t.createSnapshot()}}computeTasks(e,t){try{const s=this.handler.getTasks(e,t);return(0,n.isPromise)(s)?s.catch((e=>((0,n.reportResourceError)(t," computeTasks ",e),{tasks:[],status:{valid:!1,message:e.message},dependencies:new Set}))):s}catch(e){return(0,n.reportResourceError)(t," computeTasks",e),{tasks:[],status:{valid:!1,message:e.message},dependencies:new Set}}}performCompute(e,t,s){const r=this._timer(),i={changes:[]},o=()=>this._timer()-r>this.options.maxWorkTime,a=[...s],c=s=>{const r=this.handler.performTask(s,e,t,a.slice(1)),u=s=>{if(a.shift(),i.changes.push(...s.changes),0===a.length||o()){this.tasks[e.getSerializedId()]=a;const s=this.handler.getProgressChanges(this.fullTasks[e.getSerializedId()],a);return i.changes.push(...s),a.length&&(this.timeouts[e.getSerializedId()]=setTimeout((()=>{this.performNextCompute(e,t)}),this.options.minSleepTime)),i}return c(a[0])};return(0,n.isPromise)(r)?r.then(u):u(r)};return 0===a.length?i:c(a[0])}performNextCompute(e,t){const s=this.getTasks(e);if(s.length){const r=this.performCompute(e,t,s),i=t=>{this.batcher.batchAll((()=>{for(const s of t.changes)e.applyChange(s);e.setStatus(t.status||{valid:!0})}))};return(0,n.isPromise)(r)?void r.then(i).catch((t=>(0,n.reportResourceError)(e," initialization ",t))):void i(r)}}}t.OneWayIncrementalComputedStrategyMaster=a,t.OneWayIncrementalComputedStrategy=function(e){return(t,s,n)=>{var c;const u=e.customResourceClass||r.Resource,h="string"==typeof e.sourceEnv?e.sourceEnv:e.sourceEnv.env;return s.id===h?new a(u,h,t,n,e.manipulator||new o.JsonManipulator,e.handler,{maxWorkTime:e.maxWorkTime,minSleepTime:e.minSleepTime,startValue:e.startValue,emptyValue:null!==(c=e.emptyValue)&&void 0!==c?c:{...e.startValue,progress:1},changeBufferTime:e.changeBufferTime},e.testTimer):new i.OneWayStrategySlave(u,h,t,n,e.manipulator||new o.JsonManipulator,s.subscribeToRemote)}}},91792:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.OneWayStrategy=t.OneWayStrategySlave=t.OneWayStrategyMaster=void 0;const r=s(14572),n=s(69462),i=s(76893),o=s(73836);class a{constructor(e,t,s,r,n,i){this.resourceClass=e,this.envId=t,this.type=s,this.batcher=r,this.manipulator=n,this.provider=i}getManipulator(){return this.manipulator}createResource(e){return new this.resourceClass(e,{batcher:this.batcher,provider:this.provider,manipulator:this.manipulator,resourceType:this.type})}remoteInitializeResource(){throw new Error(" one way strategy master cannot be remote initialized")}getValueFromHandler(e,t){try{return this.provider.provide(e,t)}catch(e){return(0,i.reportResourceError)(t," invalidate ",e),{value:void 0,status:{valid:!1,message:e.message}}}}onRemoteChanges(e,t,s){return{status:"failure",statusChanged:!!t.newStatus&&s.setStatus(t.newStatus),reason:"OneWayStrategyMaster does not allow remote changes from "+e}}getMasterSyncerId(){return this.envId}isLocalChangeAllowed(){return!0}}t.OneWayStrategyMaster=a;class c{constructor(e,t,s,r,n,i){this.resourceClass=e,this.masterId=t,this.type=s,this.batcher=r,this.manipulator=n,this.subscribeToRemote=i,this.remoteChanges=new WeakSet,this.validateChange=e=>{if(!this.remoteChanges.has(e))throw new Error(`Resource ${this.type} strategy doesn't allow local changes`);this.remoteChanges.delete(e)}}getManipulator(){return this.manipulator}createResource(e){const{promise:t,resolve:s,reject:r}=(0,n.deferred)(),i=new this.resourceClass(e,{batcher:this.batcher,provider:{provide:async()=>t},manipulator:this.manipulator,resourceType:this.type},this.validateChange);return this.subscribeToRemote(this.masterId,i).then((e=>{s(e)})).catch((e=>{r(e)})),i}remoteInitializeResource(e,t){return new this.resourceClass(e,{batcher:this.batcher,provider:{provide:()=>t},manipulator:this.manipulator,resourceType:this.type},this.validateChange)}onRemoteChanges(e,t,s){var r;const n=!!t.newStatus&&s.setStatus(t.newStatus);if(t.changes)for(const e of t.changes)this.remoteChanges.add(e),s.isReady()?s.applyChange(e,!0):null===(r=s.ready)||void 0===r||r.then((()=>{s.applyChange(e,!0)})).catch((e=>(0,i.reportResourceError)(s," remote changes applied ",e)));return{status:"success",statusChanged:n}}getMasterSyncerId(){return this.masterId}isLocalChangeAllowed(){return!1}}t.OneWayStrategySlave=c,t.OneWayStrategy=function(e){return(t,s,n)=>{const i=e.customResourceClass||r.Resource,u="string"==typeof e.sourceEnv?e.sourceEnv:e.sourceEnv.env;return s.id===u?new a(i,u,t,n,e.manipulator||new o.JsonManipulator,e.handler):new c(i,u,t,n,e.manipulator||new o.JsonManipulator,s.subscribeToRemote)}}},77163:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.QueryStrategy=t.QueryStrategySlave=t.QueryStrategyMaster=void 0;const r=s(76893),n=s(91439),i=s(90294),o=s(69462),a=s(73858);class c{constructor(e,t,s,r,n,i,o){this.resourceClass=e,this.envId=t,this.type=s,this.batcher=r,this.queryResultTypes=n,this.dependenciesTypes=i,this.handler=o,this.dependencies={},this.onQueryUpdate=(e,t,s)=>{const r=e.getResults();this.dependencies[e.getSerializedId()]||(this.dependencies[e.getSerializedId()]=new Set),t.results.forEach((t=>t.use(e))),t.dependencies.forEach((t=>{t.use(e)}));const n=this.dependencies[e.getSerializedId()],i=new Set;for(const s of n)t.dependencies.has(s)||t.results.has(s)||s.release(e);for(const s of r)t.results.has(s)||(t.dependencies.has(s)||s.release(e),i.add(s));this.dependencies[e.getSerializedId()]=t.dependencies,e.setResults(t.results,i,s||new Set),e.setStatus(t.status)}}getManipulator(){return n.queryManipulator}createResource(e){let t;const s={provide:(e,s)=>{try{t=this.handler.query(e,s)}catch(e){(0,r.reportResourceError)(n," initialization ",e),t={dependencies:new Set,results:new Set,status:{valid:!1,message:e.message},metaData:null}}return(0,r.isPromise)(t)?t.catch((e=>((0,r.reportResourceError)(n," async init ",e),{dependencies:new Set,results:new Set,status:{valid:!1,message:e.message},metaData:null}))).then((e=>(this.onQueryUpdate(s,e),{value:h(e.results,e.metaData),status:e.status}))):{value:h(t.results,t.metaData),status:t.status}},dispose:e=>{this.handler.dispose&&this.handler.dispose(e),this.onResourceDisposed(e)}},n=new this.resourceClass(e,{batcher:this.batcher,provider:s,resourceType:this.type});return(0,r.isPromise)(t)||this.onQueryUpdate(n,t,void 0),n}remoteInitializeResource(){throw new Error(" two way startegy master cannot be remote initialized")}onRemoteChanges(e,t,s){return{status:"failure",statusChanged:!!t.newStatus&&s.setStatus(t.newStatus),reason:"QueryStrategyMaster does not allow remote changes from "+e}}isLocalChangeAllowed(){return!0}getMasterSyncerId(){return this.envId}dependenciesToSync(e){return e.getResults()}onDependencyChange(e,t){const s=Object.keys(t),n=s.find((e=>this.dependenciesTypes.includes(e))),i=s.find((e=>this.queryResultTypes.includes(e)));if(!n&&!i)return{recomputedVal:[],recomputedStatus:[]};const o=[],a=Object.keys(e);for(const s of a){const i=e[s],a=this.dependencies[i.getSerializedId()]||new Set,c=new Set(n?[...a].filter((e=>t[e.getType()]&&t[e.getType()].includes(e.getSerializedId()))):[]),h=new Set([...i.getResults()].filter((e=>t[e.getType()]&&t[e.getType()].includes(e.getSerializedId()))));if(c.size){const e=this.recomputeResource(i,c);try{if((0,r.isPromise)(e))e.then((e=>{const t=u(i.getResults(),e.results);this.onQueryUpdate(i,e,h),i.isValid()&&i.applyChange(t)})).catch((e=>{(0,r.reportResourceError)(i," recompute ",e),i.invalidate(e.message)}));else{const t=u(i.getResults(),e.results);this.onQueryUpdate(i,e,h),i.isValid()&&i.applyChange(t),o.push(s)}}catch(e){(0,r.reportResourceError)(i," recompute ",e),i.invalidate(e.message)}}else h.size&&i.setResults(i.getResults(),new Set,h)}return{recomputedVal:o,recomputedStatus:[]}}recomputeResource(e,t){const s=this.dependencies[e.getSerializedId()];try{if(this.handler.updateQuery){const n=this.handler.updateQuery(e,t,{results:e.getResults(),dependencies:s,status:e.getStatus(),metaData:e.getMetaData()});return(0,r.isPromise)(n)?n.catch((t=>((0,r.reportResourceError)(e," recompute ",t),{dependencies:s,results:new Set,status:{valid:!1,message:t.message},metaDataChanges:[]}))):n}const n=this.handler.query(e.getId(),e);return(0,r.isPromise)(n)?n.catch((t=>((0,r.reportResourceError)(e," recompute ",t),{dependencies:s,results:new Set,status:{valid:!1,message:t.message},metaData:null}))).then((t=>({...t,metaDataChanges:e.getMetaData()===t.metaData?[]:[(0,a.fullChange)(t.metaData)]}))):{...n,metaDataChanges:[]}}catch(t){return(0,r.reportResourceError)(e," recompute ",t),{dependencies:s,results:new Set,status:{valid:!1,message:t.message},metaDataChanges:[]}}}onResourceDisposed(e){const t=e.getSerializedId();if(this.dependencies[t]){for(const s of this.dependencies[t])s.release(e);delete this.dependencies[t]}for(const t of e.getResults())t.release(e)}}function u(e,t){const s=[],r=[];for(const s of e)[...t].find((e=>(0,n.isSameResource)(s,e)))||r.push(d(s));for(const r of t)[...e].find((e=>(0,n.isSameResource)(r,e)))||s.push(d(r));return{kind:"partial",added:s,removed:r}}function h(e,t){return{resources:[...e].map(d),metaData:t}}t.QueryStrategyMaster=c;const d=e=>({type:e.getType(),id:e.getId(),serializedId:e.getSerializedId()});class p{constructor(e,t,s,r,n,i,o){this.resourceClass=e,this.masterId=t,this.type=s,this.batcher=r,this.subscribeToRemote=n,this.queryResultTypes=i,this.getFromLocal=o}createResource(e){const{promise:t,resolve:s,reject:r}=(0,o.deferred)(),n=new this.resourceClass(e,{batcher:this.batcher,provider:{provide:()=>t,dispose:this.onResourceDisposed},resourceType:this.type});return this.subscribeToRemote(this.masterId,n).then((async e=>{await this.updateDependencies(n,e.value),s(e)})).catch((e=>{r(e)})),n}getManipulator(){return n.queryManipulator}remoteInitializeResource(e,t){return new this.resourceClass(e,{batcher:this.batcher,provider:{provide:()=>({value:t}),dispose:this.onResourceDisposed},resourceType:this.type})}onRemoteChanges(e,t,s){const r=!!t.newStatus&&s.setStatus(t.newStatus);return t.changes&&(t.changes.forEach((e=>{s.applyChange(e,!0);for(const t of e.removed)this.getFromLocal(t.type,t.id).release(s)})),this.updateDependencies(s,s.getLatest()).catch((e=>{throw new Error("query strategy, update dependecies failed with"+e)}))),{status:"success",statusChanged:r}}getMasterSyncerId(){return this.masterId}isLocalChangeAllowed(){return!1}getResourceDependenciesType(){return this.queryResultTypes}onDependencyChange(e,t){const s=Object.keys(t),r=this.getResourceDependenciesType();if(!s.find((e=>r.includes(e))))return{recomputedVal:[],recomputedStatus:[]};const n=Object.keys(e);for(const s of n){const r=e[s],n=r.getResults();if(n){const e=new Set([...n].filter((e=>t[e.getType()]&&t[e.getType()].includes(e.getSerializedId()))));e.size&&r.setResults(n,new Set,e,!0)}}return{recomputedVal:[],recomputedStatus:[]}}async updateDependencies(e,t){const s=t.resources.map((e=>this.getFromLocal(e.type,e.id))),r=s.filter((e=>!e.isReady())).map((e=>e.ready));r.length&&await Promise.all(r);const n=e.getResults(),i=new Set;if(n)for(const e of n)i.add(e);e.setResults(new Set(s),i,new Set)}onResourceDisposed(e){for(const t of e.getResults())t.release(e)}}t.QueryStrategySlave=p,t.QueryStrategy=function(e){return(t,s,r)=>{const n=e.customResourceClass||i.QueryResource,o="string"==typeof e.sourceEnv?e.sourceEnv:e.sourceEnv.env;return s.id===o?new c(n,o,t,r,e.resultTypes.map((e=>e.getTypeName())),e.dependencyTypes.map((e=>e.getTypeName())),e.handler):new p(n,o,t,r,s.subscribeToRemote,e.resultTypes.map((e=>e.getTypeName())),s.get.bind(s))}}},80375:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.TwoWayComputedStrategy=t.TwoWayComputedStrategySlave=t.TwoWayComputedStrategyMaster=void 0;const r=s(98522),n=s(14572),i=s(69462),o=s(76893),a=s(86307);class c{constructor(e,t,s,r,n,i,o,a){this.resourceClass=e,this.envId=t,this.type=s,this.batcher=r,this.syncer=n,this.manipulator=i,this.dependencyTypes=o,this.handler=a,this.dependencies={},this.snaps={},this.dependencySnaps={}}getResourceDependenciesType(){return this.dependencyTypes}getManipulator(){return this.manipulator}createResource(e){const t={provide:(e,t)=>{const s=e=>(this.updateDependencies(t,e.dependencies),e),r=this.safeCompute(e,t);return(0,o.isPromise)(r)?r.then(s):s(r)},dispose:e=>{this.handler.dispose&&this.handler.dispose(e),this.onResourceDisposed(e)}},s=new this.resourceClass(e,{batcher:this.batcher,provider:t,manipulator:this.manipulator,resourceType:this.type}),r=e=>{const t=e.getType(),s=e.getSerializedId();if(this.snaps[t]||(this.snaps[t]={}),this.snaps[t][s]=e.createSnapshot(),this.dependencies[s]){this.dependencySnaps[s]||(this.dependencySnaps[s]={});for(const e of this.dependencies[s]){const t=e.getSerializedId(),r=e.getType();this.dependencySnaps[s][r]||(this.dependencySnaps[s][r]={}),this.dependencySnaps[s][r][t]&&this.dependencySnaps[s][r][t].dispose(),this.dependencySnaps[s][r][t]=e.createSnapshot()}}};return s.isReady()?r(s):s.ready.then((()=>{r(s)})).catch((e=>(0,o.reportResourceError)(s," init ",e))),s}remoteInitializeResource(){throw new Error(" two way startegy master cannot be remote initialized")}getValueFromHandler(e,t){return this.safeCompute(e,t)}onRemoteChanges(e,t,s,r){const n=!!t.newStatus&&s.setStatus(t.newStatus),{changes:i}=t;if(i){const t=r.connections[e],o=s.getChangesFromVersion(t.approvedSnap);if(o.length>0){let e=[];if(void 0!==this.manipulator.merger){const t=this.manipulator.merger(s.getLatest(),o,i);e=t.changesRevoked;for(const e of t.changesToApply)s.applyChange(e)}else e=i;return e.length>0?{status:"failure",statusChanged:n,reason:"master has newer changes"}:{status:"success",statusChanged:n}}for(const e of i)s.applyChange(e)}return{status:"success",statusChanged:n}}onChangeResult(e,t,s){if("failure"===s.status)throw new Error("TwoWayStrategyMaster changes can not be rejected from "+e)}getMasterSyncerId(){return this.envId}isLocalChangeAllowed(){return!0}onResourceDisposed(e){const t=e.getSerializedId();if(this.dependencies[t]){for(const s of this.dependencies[t])s.release(e);delete this.dependencies[t]}}onDependencyChange(e,t){const s=Object.keys(t),r=this.getResourceDependenciesType();if(!s.find((e=>r.includes(e))))return{recomputedVal:[],recomputedStatus:[]};const n=[],i=[],a=Object.keys(e);for(const s of a){const r=this.dependencies[s];if(r){const a=new Set([...r].filter((e=>t[e.getType()]&&t[e.getType()].includes(e.getSerializedId()))));if(a.size){const t=e[s],r=t.getType(),c=e=>{this.updateDependencies(t,e.dependencies);const n=0!==e.changes.length,i=t.setStatus(e.status);if(n){this.snaps[r][s].dispose();for(const s of e.changes)t.applyChange(s,!0);if(this.handler.validator){const e=this.handler.validator(t,t.getLatest());for(const s of e)t.applyChange(s)}this.snaps[r][s]=t.createSnapshot();for(const e of a){const s=e.getSerializedId();this.dependencySnaps[t.getSerializedId()][e.getType()][s].dispose(),this.dependencySnaps[t.getSerializedId()][e.getType()][s]=e.createSnapshot()}}return{changedVal:n,changedStatus:i}},u=this.recomputeResource(t,a);try{if((0,o.isPromise)(u))u.then(c).catch((e=>{(0,o.reportResourceError)(t," recompute ",e),t.invalidate(e.message)}));else{const e=c(u);e.changedVal&&n.push(s),e.changedStatus&&i.push(s)}}catch(e){(0,o.reportResourceError)(t," recompute ",e),t.invalidate(e.message)}}}}return{recomputedVal:n,recomputedStatus:i}}onComputeBack(e){const t={value:e.getLatest(),dependencies:this.dependencies[e.getSerializedId()],status:{valid:!0}};try{const s=this.handler.recomputeBack(t,e,this.snaps[e.getType()][e.getSerializedId()]),r=e.getSerializedId(),n=t=>{const s=Object.keys(t);for(const e of s)for(const s of Object.keys(t[e])){const n=this.syncer.get(e,(0,a.deserializeId)(s));this.dependencySnaps[r]||(this.dependencySnaps[r]={}),this.dependencySnaps[r][e]||(this.dependencySnaps[r][e]={}),this.dependencySnaps[r][e][s]&&this.dependencySnaps[r][e][s].dispose();for(const r of t[e][s])n.applyChange(r);this.dependencySnaps[r][e][s]=n.createSnapshot()}s.length&&(this.snaps[e.getType()][r].dispose(),this.snaps[e.getType()][r]=e.createSnapshot())};(0,o.isPromise)(s)?s.then(n).catch((t=>(0,o.reportResourceError)(e," compute-back ",t))):n(s)}catch(e){if("Recompute aborted"!==(null==e?void 0:e.message))throw e}return Array.from(t.dependencies).map((e=>({type:e.getType(),id:e.getId(),serializedId:e.getSerializedId()})))}hasComputeBackValidate(){return!!this.handler.validator}onComputeBackValidate(e){if(this.handler.validator){const t=this.handler.validator(e,e.getLatest());for(const s of t)e.applyChange(s);this.snaps[e.getType()][e.getSerializedId()]&&this.snaps[e.getType()][e.getSerializedId()].dispose(),this.snaps[e.getType()][e.getSerializedId()]=e.createSnapshot()}return!1}recomputeResource(e,t){const s=e.getSerializedId(),r=this.dependencies[s];try{const n=this.handler.recompute(e,this.dependencySnaps[s],t,r);return(0,o.isPromise)(n)?n.catch((t=>((0,o.reportResourceError)(e," recompute ",t),{changes:[],status:{valid:!1,message:t.message},dependencies:r}))):n}catch(t){return(0,o.reportResourceError)(e," recompute ",t),{changes:[],status:{valid:!1,message:t.message},dependencies:r}}}updateDependencies(e,t){const s=this.dependencies[e.getSerializedId()];if(s!==t){if(this.dependencies[e.getSerializedId()]=t,s)for(const r of s)t.has(r)||r.release(e);for(const r of t)s&&s.has(r)||r.use(e)}}safeCompute(e,t){const s=this.dependencies[t.getSerializedId()]||new Set;try{const r=this.handler.compute(e,t);return(0,o.isPromise)(r)?r.catch((e=>((0,o.reportResourceError)(t," safe compute ",e),{value:void 0,status:{valid:!1,message:e.message},dependencies:s}))):r}catch(e){return(0,o.reportResourceError)(t," safe compute ",e),{value:void 0,status:{valid:!1,message:e.message},dependencies:s}}}}t.TwoWayComputedStrategyMaster=c;class u{constructor(e,t,s,r,n,i,o){this.resourceClass=e,this.masterId=t,this.type=s,this.batcher=r,this.manipulator=n,this.subscribeToRemote=i,this.logger=o}createResource(e){const{promise:t,resolve:s,reject:r}=(0,i.deferred)(),n=new this.resourceClass(e,{batcher:this.batcher,provider:{provide:async()=>t},manipulator:this.manipulator,resourceType:this.type});return this.subscribeToRemote(this.masterId,n).then((e=>{s(e)})).catch((e=>{r(e)})),n}getManipulator(){return this.manipulator}remoteInitializeResource(e,t){return new this.resourceClass(e,{batcher:this.batcher,provider:{provide:()=>t},manipulator:this.manipulator,resourceType:this.type})}onRemoteChanges(e,t,s,n){if(e!==this.masterId)throw new Error("messages from unknown syncer");const i=!!t.newStatus&&s.setStatus(t.newStatus);if(!s.isReady())return{status:"failure",statusChanged:i,reason:"Resource slave is not ready"};const{changes:o}=t;if(o){const t=n.connections[e],i=s.getChangesFromVersion(t.approvedSnap),a=[...o];if(o.length&&!(0,r.isFullChange)(o[0]))for(const e of s.getInvertingChangesFromVersion(t.approvedSnap))a.unshift(e);for(const e of a)s.applyChange(e,!0);const c=[...o];let u=[];if(0!==i.length){if(void 0!==this.manipulator.merger){const e=this.manipulator.merger(s.getLatest(),c,i);u=e.changesRevoked;for(const t of e.changesToApply)s.applyChange(t,!0)}else u=o;u.length>0&&this.logger.warn({value:"changes rejected because of new change from master",metadata:{changesFromMaster:o,changesRevoked:u}})}}return{status:"success",statusChanged:i}}isLocalChangeAllowed(){return!0}getMasterSyncerId(){return this.masterId}}t.TwoWayComputedStrategySlave=u,t.TwoWayComputedStrategy=function(e){return(t,s,r,i)=>{const o=e.customResourceClass||n.Resource,a="string"==typeof e.sourceEnv?e.sourceEnv:e.sourceEnv.env;return s.id===a?new c(o,a,t,r,s,e.manipulator,e.dependencies.map((e=>e.getTypeName())),e.handler):new u(o,a,t,r,e.manipulator,s.subscribeToRemote,i)}}},72288:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.TwoWayStrategy=t.TwoWayStrategySlave=t.TwoWayStrategyMaster=void 0;const r=s(98522),n=s(14572),i=s(69462),o=s(76893);class a{constructor(e,t,s,r,n,i){this.resourceClass=e,this.envId=t,this.type=s,this.batcher=r,this.manipulator=n,this.provider=i}getManipulator(){return this.manipulator}createResource(e){return new this.resourceClass(e,{batcher:this.batcher,provider:this.provider,manipulator:this.manipulator,resourceType:this.type})}remoteInitializeResource(){throw new Error(" two way startegy master cannot be remote initialized")}getValueFromHandler(e,t){try{return this.provider.provide(e,t)}catch(e){return(0,o.reportResourceError)(t," invalidate ",e),{value:void 0,status:{valid:!1,message:e.message}}}}onRemoteChanges(e,t,s,r){const n=!!t.newStatus&&s.setStatus(t.newStatus),{changes:i}=t,o=r.connections[e];if(i&&o){const e=s.getChangesFromVersion(o.approvedSnap);if(e.length>0){let t=[];if(void 0!==this.manipulator.merger){const r=this.manipulator.merger(s.getLatest(),e,i);t=r.changesRevoked;for(const e of r.changesToApply)s.applyChange(e)}else t=i;return t.length>0?{status:"failure",statusChanged:n,reason:"master has newer changes"}:{status:"success",statusChanged:n}}for(const e of i)s.applyChange(e)}return{status:"success",statusChanged:n}}onChangeResult(e,t,s){if("failure"===s.status)throw new Error("TwoWayStrategyMaster changes can not be rejected from "+e)}getMasterSyncerId(){return this.envId}isLocalChangeAllowed(){return!0}}t.TwoWayStrategyMaster=a;class c{constructor(e,t,s,r,n,i,o){this.resourceClass=e,this.masterId=t,this.type=s,this.batcher=r,this.manipulator=n,this.subscribeToRemote=i,this.logger=o}createResource(e){const{promise:t,resolve:s,reject:r}=(0,i.deferred)(),n=new this.resourceClass(e,{batcher:this.batcher,provider:{provide:async()=>t},manipulator:this.manipulator,resourceType:this.type});return this.subscribeToRemote(this.masterId,n).then((e=>{s(e)})).catch((e=>{r(e)})),n}getManipulator(){return this.manipulator}remoteInitializeResource(e,t){return new this.resourceClass(e,{batcher:this.batcher,provider:{provide:()=>t},manipulator:this.manipulator,resourceType:this.type})}onRemoteChanges(e,t,s,n){if(e!==this.masterId)throw new Error("messages from unknown syncer");const i=!!t.newStatus&&s.setStatus(t.newStatus);if(!s.isReady())return{status:"failure",statusChanged:i,reason:"Resource slave is not ready"};const{changes:o}=t;if(o){const t=n.connections[e],i=s.getChangesFromVersion(t.approvedSnap),a=[...o];if(o.length&&!(0,r.isFullChange)(o[0]))for(const e of s.getInvertingChangesFromVersion(t.approvedSnap))a.unshift(e);for(const e of a)s.applyChange(e,!0);const c=[...o];let u=[];if(0!==i.length){if(void 0!==this.manipulator.merger){const e=this.manipulator.merger(s.getLatest(),c,i);u=e.changesRevoked;for(const t of e.changesToApply)s.applyChange(t,!0)}else u=o;u.length>0&&this.logger.warn({value:"changes rejected because of new change from master",metadata:{changesFromMaster:o,changesRevoked:u}})}}return{status:"success",statusChanged:i}}isLocalChangeAllowed(){return!0}getMasterSyncerId(){return this.masterId}}t.TwoWayStrategySlave=c,t.TwoWayStrategy=function(e){return(t,s,r,i)=>{const o=e.customResourceClass||n.Resource,u="string"==typeof e.sourceEnv?e.sourceEnv:e.sourceEnv.env;return s.id===u?new a(o,u,t,r,e.manipulator,e.handler):new c(o,u,t,r,e.manipulator,s.subscribeToRemote,i)}}},42580:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getEmptyPendingSyncerInfo=t.pendingSyncerMessageTypes=void 0,t.pendingSyncerMessageTypes=["pendingChanges","pendingStatusChanges","openRequests","openRequestsResult","changesResult","pushOpenRequests","closeRequests","disconnectSyncers"],t.getEmptyPendingSyncerInfo=()=>{const e={};for(const s of t.pendingSyncerMessageTypes)e[s]="disconnectSyncers"===s?[]:{};return e}},84488:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.mergeChangeSets=t.cloneIdList=t.resourceMapToIdList=t.mergeResourceMaps=t.resourceSetToList=void 0,t.resourceSetToList=function(e){return Object.keys(e).reduce(((t,s)=>(t[s]=[...e[s]],t)),{})},t.mergeResourceMaps=function(e,...t){const s={};for(const r of t)Object.keys(r).reduce(((t,s)=>(t[s]=Object.keys(r[s]).reduce(((t,n)=>(void 0!==t[n]?t[n]=e(t[n],r[s][n],n):t[n]=r[s][n],t)),t[s]||{}),t)),s);return s},t.resourceMapToIdList=function(e,t=(()=>!0)){const s={};for(const r of Object.keys(e))for(const n of Object.keys(e[r]))t(e[r][n])&&(s[r]||(s[r]=[]),s[r].push(n));return s},t.cloneIdList=function(e){const t={};for(const s in e)t[s]=[...e[s]];return t},t.mergeChangeSets=function(e,t){for(const s of Object.keys(t))if(e[s]){const r=e[s],n=t[s];for(const e of n)r.add(e)}else e[s]=t[s]}},68537:(e,t,s)=>{var r;Object.defineProperty(t,"__esModule",{value:!0}),t.ResourceSyncer=void 0;const n=s(42580),i=s(69462),o=s(93849),a=s(86307),c=s(84488),u=s(91570);t.ResourceSyncer=class{constructor(e,t,s,n){this.id=e,this.batcher=t,this.loggerService=n,this[r]={messageFromRemote:(0,o.multiTenantMethod)(this.messageFromRemote)},this.syncers={},this.resources={},this.preDisposalChanges={},this.resoureRemotePromise={},this.rTypesOrder=[],this.resourceConfigs={},this.isCollectingMessages=!1,this.connectionListeners=new Set,this.registrationListeners=new Set,this.subscribeToRemote=async(e,t)=>{if(!this.syncers[e])throw new Error("unknown syncer cannot connnect");const s=t.getType(),r=t.getSerializedId();return this.linkResourceToMasterSyncer(e,s,r,t),this.hasCollectedCloseRequestWith(e,s,r)&&this.syncers[e].closeRequests[s].delete(r),this.resoureRemotePromise[s][r]=(0,i.deferred)(),this.updateSyncer(e,{openRequests:{[s]:new Set([r])}}),this.resoureRemotePromise[s][r].promise},this.onBatchChange=e=>{e.batchId!==this.runningBatch&&this.reactToLocalChanges(e.changed,e.changedStatus)},this.disposeResource=e=>{const t=e.getType(),s=e.getSerializedId(),r=this.resourceConfigs[t].resourceManager.getMasterSyncerId();if(this.resources[t][s])for(const r of Object.keys(this.resources[t][s].connections)){const n=e.getChangesFromVersion(this.resources[t][s].connections[r].snap);this.preDisposalChanges[r]||(this.preDisposalChanges[r]={}),this.preDisposalChanges[r][t]||(this.preDisposalChanges[r][t]={}),this.preDisposalChanges[r][t][s]||(this.preDisposalChanges[r][t][s]=[]),this.preDisposalChanges[r][t][s]=this.preDisposalChanges[r][t][s].concat(n)}delete this.resources[t][s];const n=e.results;if(void 0!==n)for(const e of n){const t=e.getSerializedId(),s=e.getType();this.resources[s][t]&&e.release(this.resources[s][t].connections[r])}r!==this.id&&this.updateSyncer(r,{closeRequests:{[t]:new Set([s])}})};for(const e of Object.keys(s))this.registerResourceType(e,s[e]);t.subscribe(this.onBatchChange)}hasSyncer(e){return!!this.syncers[e]}getRegisteredEnvs(){return Object.keys(this.syncers)}getRegisteredResourceManagers(){return Object.values(this.resourceConfigs).map((e=>e.resourceManager))}addConnectionListener(e){this.connectionListeners.add(e)}removeConnectionListener(e){this.connectionListeners.delete(e)}addRegistartionListener(e){this.registrationListeners.add(e)}removeRegistrationListener(e){this.registrationListeners.delete(e)}registerResourceType(e,t){this.resourceConfigs[e]=t,this.insertInOrder(e,t),this.resources[e]={},this.resoureRemotePromise[e]={},t.resourceManager.subscribeToOpen(((e,s)=>{const r=t.resourceManager.getOpen();for(const e of s)r.includes(e)&&this.disposeResource(t.resourceManager.getResource((0,a.deserializeId)(e)))})),this.registrationListeners.forEach((e=>e()))}insertInOrder(e,t){const s=this.rTypesOrder.findIndex((e=>this.resourceConfigs[e].dependenciesBaseTypeName&&this.resourceConfigs[e].dependenciesBaseTypeName.includes(t.baseTypeName)));-1==s?this.rTypesOrder.push(e):this.rTypesOrder.splice(s,0,e)}addResourceDependency(e,t){const s=e.getTypeName(),r=this.resourceConfigs[s];if(!r)throw new Error("Cannot add depndency to unknown Resourcemanager");r.dependenciesBaseTypeName.push(t.baseTypeName),this.rTypesOrder.splice(this.rTypesOrder.indexOf(s),1),this.insertInOrder(s,r)}connectSyncer(e,t){this.syncers[e]||(this.syncers[e]={syncer:t,isPending:!1,...(0,n.getEmptyPendingSyncerInfo)()},this.connectionListeners.forEach((e=>e())))}disconnectSyncer(e){if(this.syncers[e]){for(const[t,s]of Object.entries(this.resources))for(const r of Object.keys(s))this.remoteDisposeRequest(e,t,r);delete this.syncers[e],this.connectionListeners.forEach((e=>e()))}}get(e,t,s){if(!this.resourceConfigs[e])throw new Error("unknown resource type "+e);return this.resourceConfigs[e].resourceManager.get(t,s)}async getReady(e,t,s){const r=this.get(e,t,s);return await r.ready,r}getOpenResources(e){if(!this.resourceConfigs[e])throw new Error("unknown resource type "+e);return this.resourceConfigs[e].resourceManager.getOpen()}isOpen(e,t){if(!this.resourceConfigs[e])throw new Error("unknown resource type "+e);return this.resourceConfigs[e].resourceManager.isOpen(t)}async isRemoteOpen(e,t,s){if(!this.syncers[s])throw new Error("unknown syncer cannot query open");return await this.syncers[s].syncer.isOpen(e,t)}hasCollectedCloseRequestWith(e,t,s){var r;return(this.isCollectingMessages||this.syncers[e].isPending)&&(null===(r=this.syncers[e].closeRequests[t])||void 0===r?void 0:r.has(s))}messageFromRemote(e,t,{closeRequests:s,openRequests:r,openRequestsResults:n,changeRequests:i,changesResult:o,pushOpenRequests:h}){const d=e;let p=!1;const l={},g={},f=(0,c.resourceMapToIdList)(i,(e=>!!e.changes)),y=(0,c.resourceMapToIdList)(i,(e=>!!e.newStatus));this.runningBatch=Math.random(),this.loggerService.info({value:`message from ${d} to ${this.id}`,metadata:{closeRequests:s,openRequests:r,openRequestsResults:n,changeRequests:i,changesResult:o,pushOpenRequests:h}}),this.startCollectingMessages();const m=this.batcher.batchAll((()=>{var e,t;for(const e of this.rTypesOrder){for(const t of r[e]||[])this.remoteResourceRequest(d,e,t).catch(u.reportError);for(const t of Object.keys(n[e]||[]))this.remoteResourceResponse(d,e,t,n[e][t]);for(const t of Object.keys(h[e]||[]))this.remotePushOpen(d,e,t,h[e][t]);if(o[e]&&this.remoteChangeResult(d,e,o[e]),i[e]){this.remoteChangeRequest(d,e,i[e]);for(const t of Object.keys(i[e]))if(i[e][t].changes)for(const s of i[e][t].changes){const e=s.removed;if(void 0!==e)for(const t of e)this.get(t.type,t.id).release(this.resources[t.type][t.serializedId].connections[d])}}}const s={};for(const r of this.rTypesOrder.slice().reverse()){const n=this.resourceConfigs[r];if(n.resourceManager.hasComputeBack()){const o=[...f[r]?f[r]:[],...l[r]||[]];for(const c of o){let o;try{o=n.resourceManager.onComputeBack(n.resourceManager.get((0,a.deserializeId)(c)));for(const e of o||[])f[e.type]||(f[e.type]=[]),f[e.type].push(e.serializedId),p=!0,l[e.type]||(l[e.type]=[]),l[e.type].push(e.serializedId)}catch(s){(0,u.reportError)(s);const o=n.resourceManager.getResource((0,a.deserializeId)(c)),h=(null===(t=null===(e=i[r])||void 0===e?void 0:e[c])||void 0===t?void 0:t.changes)||[];if(o.revertChanges(h)){const e={};e[r]=[c],this.updateSyncersAfterChanges(e,{})}}void 0!==o&&o.length&&n.resourceManager.hasComputeBackValidate()&&(s[r]=s[r]||[],s[r].push(c))}}}for(const e of this.rTypesOrder){const t=this.resourceConfigs[e];if(s[e])for(const r of s[e])t.resourceManager.onComputeBackValidate(t.resourceManager.get((0,a.deserializeId)(r)))&&(l[e]=l[e]||[],l[e].push(r));if(Object.keys(f).length){const s=t.resourceManager.onDependencyChange(f);s.recomputedVal.length&&(p=!0,this.updateNewlyComputed(l,f,e,s.recomputedVal)),s.recomputedStatus.length&&(p=!0,this.updateNewlyComputed(g,y,e,s.recomputedStatus)),this.callManagerSubscribers(f[e],y[e],t)}}if(Object.keys(y).length)for(const e of this.rTypesOrder){const t=this.resourceConfigs[e].resourceManager.onDependencyChange(y);t.recomputedVal.length&&(p=!0,this.updateNewlyComputed(l,f,e,t.recomputedVal)),t.recomputedStatus.length&&(p=!0,this.updateNewlyComputed(g,y,e,t.recomputedStatus))}}),this.runningBatch);for(const e of this.rTypesOrder)for(const t of s[e]||[])this.remoteDisposeRequest(d,e,t);if(this.runningBatch=void 0,"failure"===m.status)throw m.error;p?this.updateSyncersAfterChanges(l,g):this.releaseCollectedMessages()}startCollectingMessages(){this.isCollectingMessages=!0}releaseCollectedMessages(){this.isCollectingMessages=!1;for(const e of Object.keys(this.syncers))this.syncers[e].isPending||this.updateSyncerIfPending(e)}reactToLocalChanges(e,t){this.runningBatch=Math.random();const s=(0,c.cloneIdList)(e),r=(0,c.cloneIdList)(t),n={},i=this.batcher.batchAll((()=>{for(const e of this.rTypesOrder.slice().reverse()){const t=this.resourceConfigs[e];if(s[e]&&t.resourceManager.hasComputeBack())for(const r of s[e]){const i=t.resourceManager.onComputeBack(t.resourceManager.get((0,a.deserializeId)(r)));for(const e of i)s[e.type]||(s[e.type]=[]),s[e.type].push(e.serializedId);i.length&&t.resourceManager.hasComputeBackValidate()&&(n[e]=n[e]||[],n[e].push(r))}}const e={};for(const t of this.rTypesOrder){const i=this.resourceConfigs[t];e[t]={};for(const s of i.resourceManager.getOpen())e[t][s]=this.resourceConfigs[t].resourceManager.get((0,a.deserializeId)(s)).isValid();if(n[t])for(const e of n[t])i.resourceManager.onComputeBackValidate(i.resourceManager.get((0,a.deserializeId)(e)))&&(s[t]=s[t]||[],s[t].push(e));const o=i.resourceManager.onDependencyChange(s);o.recomputedVal.length&&(s[t]=(s[t]||[]).concat(o.recomputedVal)),o.recomputedStatus.length&&(r[t]=(r[t]||[]).concat(o.recomputedStatus));const c=i.resourceManager.onDependencyChange(r);c.recomputedVal.length&&(s[t]=(s[t]||[]).concat(c.recomputedVal)),c.recomputedStatus.length&&(r[t]=(r[t]||[]).concat(c.recomputedStatus));for(const s of i.resourceManager.getOpen())this.resourceConfigs[t].resourceManager.getResource((0,a.deserializeId)(s)).isValid()!==e[t][s]&&(r[t]||(r[t]=[]),r[t].includes(s)||r[t].push(s));this.callManagerSubscribers(s[t],r[t],i)}}),this.runningBatch);if("failure"===i.status)throw i.error;this.updateSyncersAfterChanges({...i.changed,...s},{...i.changedStatus,...r}),this.runningBatch=void 0}updateNewlyComputed(e,t,s,r){e[s]||(e[s]=[]),e[s]=e[s].concat(r),t[s]=t[s]?t[s].concat(r):r}callManagerSubscribers(e,t,s){(e&&0!==e.length||t&&0!==t.length)&&s.resourceManager.dispatchChanges(new Set(e),new Set(t))}linkResourceToSlaveSyncer(e,t,s,r){return this.resources[t][s]=this.resources[t][s]||{connections:{}},this.resources[t][s].connections[e]||(this.resources[t][s].connections[e]={snap:r.createSnapshot(),approvedSnap:r.createSnapshot(),resource:r,toMaster:!1}),r}linkResourceToMasterSyncer(e,t,s,r){return this.resources[t][s]=this.resources[t][s]||{connections:{}},this.resources[t][s].connections[e]||(this.resources[t][s].connections[e]={snap:r.createSnapshot(),approvedSnap:r.createSnapshot(),toMaster:!1}),r}async remoteResourceRequest(e,t,s){if(!this.syncers[e])throw new Error(`unknown syncer cannot connnect ${e}`);const r=this.get(t,(0,a.deserializeId)(s));let n;this.linkResourceToSlaveSyncer(e,t,s,r),r.use(this.resources[t][s].connections[e]);try{await r.ready,n={status:"success",result:{value:r.getLatest(),status:r.getStatus()}}}catch(e){n={status:"failure",reason:e&&e.message?e.message:e.toString()}}const i={openRequestsResult:{[t]:{[s]:n}}},o=this.getDependenciesToUpdate(r,e);o&&(i.pushOpenRequests=o),this.updateSyncer(e,i)}getDependenciesToUpdate(e,t){const s=this.resourceConfigs[e.getType()];return s.resourceManager.hasDependenciesToSync()?[...s.resourceManager.dependenciesToSync(e)].reduce(((e,s)=>{const r=s.getType(),n=s.getSerializedId(),i=this.resources[r][n];return i&&i.connections[t]||(e[r]=e[r]||{},e[r][n]={result:{value:s.getLatest(),status:s.getStatus()}},this.linkResourceToSlaveSyncer(t,r,n,s)),e}),{}):null}remoteResourceResponse(e,t,s,r){if(this.resoureRemotePromise[t][s]){const e=this.resoureRemotePromise[t][s];"success"===r.status?e.resolve(r.result):e.reject(r.reason),this.resoureRemotePromise[t][s]=void 0}}remotePushOpen(e,t,s,r){if(!this.resourceConfigs[t].resourceManager.isOpen(s)){const n=this.resourceConfigs[t].resourceManager.remoteInitializeResource((0,a.deserializeId)(s),r.result);this.linkResourceToMasterSyncer(e,t,s,n),n.use(this.resources[t][s].connections[e])}}remoteChangeResult(e,t,s){const r=Object.keys(s),n=this.resourceConfigs[t];for(const i of r){const r=this.resources[t][i];if(!r)continue;const o=n.resourceManager.getResource((0,a.deserializeId)(i)),c=r.connections[e];c&&("success"===s[i].status?c.pendingApproval&&(c.approvedSnap.dispose(),c.approvedSnap=c.pendingApproval,c.pendingApproval=void 0):(c.snap=this.renewSnap(o,c.snap),c.approvedSnap=this.renewSnap(o,c.approvedSnap)))}}remoteChangeRequest(e,t,s){const r=Object.keys(s),n=this.resourceConfigs[t],i={},o={};for(const c of r){const r=this.resources[t][c];if(!r)continue;const u=n.resourceManager.getResource((0,a.deserializeId)(c)),h=n.resourceManager.onRemoteChanges(e,s[c],u,r),d=!!s[c].newStatus&&!s[c].changes;if(d&&!h.statusChanged)continue;i[c]=h;const p=r.connections[e];p&&(p.snap=this.renewSnap(u,p.snap),p.approvedSnap=this.renewSnap(u,p.approvedSnap));for(const t of Object.keys(r.connections))t!==e&&(o[t]||(o[t]={pendingChanges:new Set,pendingStatusChanges:new Set}),d?o[t].pendingStatusChanges.add(c):o[t].pendingChanges.add(c))}this.updateSyncer(e,{changesResult:{[t]:i}});for(const e of Object.keys(o))this.updateSyncer(e,{pendingChanges:{[t]:o[e].pendingChanges},pendingStatusChanges:{[t]:o[e].pendingStatusChanges}})}renewSnap(e,t){return t.dispose(),e.createSnapshot()}remoteDisposeRequest(e,t,s){var r;if(!this.syncers[e])return void console.error(`unknown syncer cannot dispose: ${e} ${t} ${s}`);if(!this.resources[t][s])return void console.error(`unknown resource cannot dispose: ${e} ${t} ${s}`);const n=this.resources[t][s],i=n.connections[e];i&&(delete n.connections[e],null===(r=i.resource)||void 0===r||r.release(i),0===Object.values(n.connections).length&&delete this.resources[t][s])}updateSyncersAfterChanges(e,t){this.startCollectingMessages();const s={};for(const t of this.rTypesOrder){const r=e[t];if(r&&r.length)for(const e of r){const n=this.resourceConfigs[t].resourceManager.getResource((0,a.deserializeId)(e));if(this.resources[t][e])for(const i of Object.keys(this.resources[t][e].connections)){s[i]=s[i]||{pendingChanges:{},pendingStatusChanges:{},pushOpenRequests:{}},s[i].pendingChanges[t]=new Set(r);const e=this.getDependenciesToUpdate(n,i);e&&(s[i].pushOpenRequests=(0,c.mergeResourceMaps)(((e,t)=>t),s[i].pushOpenRequests||{},e))}}}for(const e of this.rTypesOrder){const r=t[e];if(r&&r.length)for(const t of r)if(this.resources[e][t])for(const n of Object.keys(this.resources[e][t].connections))s[n]=s[n]||{pendingChanges:{},pendingStatusChanges:{},pushOpenRequests:{}},s[n].pendingStatusChanges[e]=new Set(r)}for(const e of Object.keys(s))this.updateSyncer(e,s[e]);this.releaseCollectedMessages()}updateSyncerIfPending(e){const t=this.syncers[e];if(!t)return;let s=!1;const r={};for(const e of n.pendingSyncerMessageTypes)Object.keys(t[e]).length&&(s=!0,r[e]=t[e]);s&&this.updateSyncer(e,r)}updateSyncer(e,t){if(!this.syncers[e])return;let s=this.syncers[e];if(this.isCollectingMessages||this.syncers[e].isPending){for(const e in t)"pendingChanges"===e||"pendingStatusChanges"===e||"openRequests"===e||"closeRequests"===e?t[e]&&(0,c.mergeChangeSets)(s[e],t[e]):"openRequestsResult"!==e&&"changesResult"!==e||(s[e]=(0,c.mergeResourceMaps)(((e,t)=>t),s[e],t[e]));return void(t.pushOpenRequests&&(s.pushOpenRequests=(0,c.mergeResourceMaps)(((e,t)=>t),s.pushOpenRequests,t.pushOpenRequests)))}s={...this.syncers[e],...(0,n.getEmptyPendingSyncerInfo)()};const r={...(0,n.getEmptyPendingSyncerInfo)(),...t};this.syncers[e]=s;const i={},o=r.pendingChanges;for(const t of Object.keys(o)){const s=this.resourceConfigs[t];if(s.resourceManager.isLocalChangeAllowed()){i[t]={};for(const r of[...o[t]]){i[t][r]={};const n=this.resources[t][r];if(n){const o=s.resourceManager.getResource((0,a.deserializeId)(r)),c=n.connections[e];if(c){const e=o.getChangesFromVersion(c.snap);i[t][r].changes=e;const s=o.getManipulator().squasher;void 0!==s&&e.length>1&&(i[t][r].changes=s(e))}}else if(this.preDisposalChanges[e]){let n=this.preDisposalChanges[e][t][r];this.preDisposalChanges[e][t]={};const o=s.manipulator.squasher;void 0!==o&&n.length>1&&(n=o(n)),i[t][r].changes=n}}for(const r of Object.keys(i[t])){const n=this.resources[t][r];if(!n)continue;const i=s.resourceManager.getResource((0,a.deserializeId)(r)),o=n.connections[e];o&&(o.snap=i.createSnapshot(),o.pendingApproval=i.createSnapshot())}}else console.error(`Resource ${t} strategy doesn't allow local changes`)}const h=r.pendingStatusChanges;for(const e of Object.keys(h)){const t=this.resourceConfigs[e];for(const s of[...h[e]]){const r=t.resourceManager.getResource((0,a.deserializeId)(s));r&&(i[e]||(i[e]={}),i[e][s]||(i[e][s]={}),i[e][s].newStatus=r.getStatus())}}let d=!0;Object.keys(i).length&&(d=!1);for(const e of n.pendingSyncerMessageTypes)Object.keys(r[e]).length&&(d=!1);if(d)return this.syncers[e].isPending=!1,void this.updateSyncerIfPending(e);const p={changeRequests:i,closeRequests:(0,c.resourceSetToList)(r.closeRequests),openRequests:(0,c.resourceSetToList)(r.openRequests),openRequestsResults:r.openRequestsResult,changesResult:r.changesResult,pushOpenRequests:r.pushOpenRequests};s.isPending=!0,s.syncer.messageFromRemote(this.id,p).finally((()=>{s.isPending=!1,this.updateSyncerIfPending(e)})).catch(u.reportError)}},r=o.SERVICE_CONFIG},98522:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.fullChange=t.isFullChange=t.FIRST_VERSION=t.NOT_INITED=void 0,t.NOT_INITED=-1,t.FIRST_VERSION=0,t.isFullChange=function(e){return"full"===e.kind},t.fullChange=e=>({kind:"full",value:e})},76893:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.modifyUtils=t.getResourceLatestValueFactory=t.getDefaultStatusHandling=t.fullChangeManipulator=t.sortByArr=t.isFunction=t.isPromise=t.nonReadyResourceError=t.invalidResourceError=t.disposedNonReadyResourceError=t.disposedResourceError=t.unknownResourceError=t.unknownVersionError=t.reportResourceError=void 0;const r=s(91570),n=s(86307);function i(e,t,s){return t.length>1&&(s=i(e[t[0]],t.slice(1),s)),s===e[t[0]]?e:Array.isArray(e)?[...e.slice(0,t[0]-1),s,...e.slice(t[0]+1)]:{...e,[t[0]]:s}}t.reportResourceError=function(e,t,s){var n;const i=new Error(null!==(n="error running "+t+" on resource of type: "+e.getType()+" with id: "+JSON.stringify(e.getId(),null,4)+" original err: "+s.stack)&&void 0!==n?n:s.message);(0,r.reportError)(i)},t.unknownVersionError=function(e,t,s){return new Error(`unknown version '${e}' for resource '${t}'. latest is ${s}.`)},t.unknownResourceError=function(e,t){return new Error(`uninitialized resource with type '${e}' and id '${t}'. try waiting for the resource to be ready.`)},t.disposedResourceError=function(e,t){return new Error(`resource  with type '${e}' and id '${t}' has been disposed`)},t.disposedNonReadyResourceError=function(e,t){return new Error(`resource  with type '${e}' and id '${t}' is not ready and already been disposed`)},t.invalidResourceError=function(e,t,s){return new Error(`resource  with type '${e}' and id '${t}' is in invalid state: ${s}`)},t.nonReadyResourceError=function(e,t){return new Error(`resource  with type '${e}' and id '${t}' is not ready`)},t.isPromise=function(e){return e&&"function"==typeof e.then},t.isFunction=function(e){return e&&"[object Function]"==={}.toString.call(e)},t.sortByArr=function(e,t){const s=t.reduce(((e,t,s)=>(e.set(t,s),e)),new Map);return e.sort(((e,t)=>(s.get(e)||0)-(s.get(t)||0)))},t.fullChangeManipulator={reducer:(e,t)=>({value:t.value,invertingChanges:[{kind:t.kind,value:e,oldValue:"full"===t.kind?void 0:t.value}]})},t.getDefaultStatusHandling=function(e,t){return Array.from(t).filter((e=>!1===e.getStatus().valid)).length?{valid:!1,message:`One of the dependencies of ${e} is invalid`}:{valid:!0}},t.getResourceLatestValueFactory=function(e){const t={},s=new Set;return{getResourceLatestValue:async r=>{const i=(0,n.serializeId)(r);return s.add(i),(await e.getReady(r,t)).getLatest()},release:()=>{s.forEach((s=>{const r=(0,n.deserializeId)(s);e.isOpen(r)&&e.get(r).release(t)})),s.clear()}}},t.modifyUtils={replace:i,remove:function e(t,s){if(s.length>1){const r=e(t[s[0]],s.slice(1));return r===t[s[0]]?t:i(t,[s[0]],r)}if(Array.isArray(t))return[...t.slice(0,s[0]-1),...t.slice(s[0]+1)];const r={...t};return delete r[s[0]],r},add:function e(t,s,r){return s.length>1?(r=e(t[s[0]],s.slice(1),r),i(t,[s[0]],r)):r===t[s[0]]?t:Array.isArray(t)?-1===s[0]?[...t,r]:[...t.slice(0,s[0]),r,...t.slice(s[0])]:{...t,[s[0]]:r}}}}}]);