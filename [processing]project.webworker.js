(self.webpackChunk_wixc3_component_playground=self.webpackChunk_wixc3_component_playground||[]).push([[5359],{3853:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i(5163),r=i(46855),n=i(63870),a=i(93849),o=s.__importDefault(i(72321)),c=i(60814),h=s.__importStar(i(31434)),d=i(33217),l=i(53863),u=i(8407),f=i(98180),g=i(33506),p=i(9883),y=i(43482),v=i(7057),m=i(47748),S=i(62868),P=i(78204),E=i(71299);h.default.setup(h.processingEnv,(({run:e,fsContents:t,fileManager:i,directoryManager:s,fileListManager:M,[a.RUN_OPTIONS]:R,onDispose:D,pluggableProjectConfig:C,ignoredSubPathsConfig:F,linkedPackages:_,fsInitializerOptions:w,undoRedoStateManager:O,dualExtensions:b,fileMetaManager:T,projectPath:{projectPath:L}},{gui:{navigationService:j}},{processingContext:{fsInitializer:U,configurationProvider:k}})=>{const x=R.get("projectPath"),I=("native"===w.fsMode?U:m.createLinkedMemoryFs)({fsContents:t,linkedPackages:_.packages}),N="string"==typeof x?I.resolve(x):null!=L?L:I.cwd(),V=(0,v.createCachedFs)((0,n.createMemoryFs)()),A=(0,r.createOverlayFs)(I,V,N);D((()=>{I.watchService.clearGlobalListeners(),A.watchService.clearGlobalListeners()}));const K=i.provide({resourceConstructor:E.FileResource,manipulator:c.stringManipulator,handler:{provide(e){o.default.mark(h.FILE_RESOURCE_PROVIDER_MARK);try{return{value:(0,l.textFileProvider)(A,e)}}catch(e){return{value:"",status:{valid:!1,message:e.message}}}}}}),B=T.provide({handler:{provide:()=>({value:{lastModifiedOrigin:""}})}}),W=O.provide({handler:{provide:()=>({value:P.UNDO_REDO_DEFAULT_VALUE})}}),z=new S.UndoRedoService(K,B,j,W),G=C.provide({dependencies:[K],handler:new p.ProjectConfigComputeHandler(A,K,N,k)}),J=G.get(h.PROJECT_CONFIG_NAME),H=J.isValid()?J.get(F):h.DEFAULT_IGNORED_SUBPATHS,$=(0,g.createPathPredicate)(A,N,H),Y=new y.DirectoryEntitiesService(N,A,$),q=s.provide({manipulator:f.directoryManipulator,handler:{provide(e){o.default.mark(h.DIRECTORY_RESOURCE_PROVIDER_MARK);try{return{value:(0,l.directoryProvider)(A,e).filter((e=>$(e.path)))}}catch(e){return{value:[],status:{valid:!1,message:e.message}}}}}}),X=new u.ProjectService({fs:I,projectPath:N,projectName:I.basename(N),dualExtensions:b}),Q=e=>"directory"!==e.type||$(e.path),Z=M.provide({handler:{provide:async function(e){try{const t=[];for await(const i of(0,g.directoryDeepChildren)(A,e,Q))"file"===i.type&&t.push(i);return{value:t}}catch(e){return{value:[],status:{valid:!1,message:e.message}}}}}}),ee=new d.FsResourceSyncer(N,A,K,Z,q,$,Y,B);return e((async()=>{await ee.init(),z.init()})),D((()=>{ee.dispose().catch(a.reportError),z.dispose()})),{fs:A,directoryEntitiesService:Y,virtualFs:V,projectService:X,fsResourcesSyncer:ee,directoryManager:q,fileManager:K,fileMetaManager:B,fileListManager:Z,pluggableProjectConfig:G,undoRedoService:z,undoRedoStateManager:W}}))},47748:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createLinkedMemoryFs=void 0;const s=i(63870);t.createLinkedMemoryFs=function({fsContents:e,linkedPackages:t=[]}){const i=(0,s.createMemoryFs)(e);for(const{directoryPath:e,packageJson:{name:s}}of t){if(!s)continue;const t=i.join("/node_modules",i.dirname(s));i.ensureDirectorySync(t),i.symlinkSync(e,i.join(t,i.basename(s)),"dir")}return i}},9883:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ProjectConfigComputeHandler=void 0;const s=i(60814);t.ProjectConfigComputeHandler=class{constructor(e,t,i,s){this.fs=e,this.fileManager=t,this.projectPath=i,this.configurationProvider=s}compute(e){if(e=this.fs.join(this.projectPath,e),!this.fs.fileExistsSync(e))return{value:{},dependencies:new Set([]),status:{valid:!1,message:`No config file ${e}`}};const t=this.fileManager.get(e),i=new Set([t]);try{return{value:this.configurationProvider(this.fs,e),dependencies:i,status:{valid:!0}}}catch(e){return{value:{},dependencies:i,status:{valid:!1,message:String(e)}}}}recompute(e,t,i,r){const{value:n,status:a}=this.compute(e.getId());return{changes:[(0,s.fullChange)(n)],dependencies:r,status:a}}}},33217:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getPartialUpdates=t.isIdenticalDirEntity=t.FsResourceSyncer=void 0;const s=i(98180),r=i(91394),n=i(91570),a=i(60814),o=i(53863),c=i(93849),h=i(18012);t.FsResourceSyncer=class{constructor(e,i,d,l,u,f=c.returnsTrue,g,p){this.directoryPath=e,this.fs=i,this.fileManager=d,this.fileListManager=l,this.directoryManager=u,this.pathPredicate=f,this.directoryEntitiesService=g,this.fileMetaManager=p,this.isUpdatingFs=!1,this.isUpdatingResources=!1,this.listeners=new Set,this.filesMtime=new Map,this.watchedDirectoriesPaths=new Set,this.batcher=this.fileManager.batcher,this.fsListener=e=>{this.pathPredicate(e.path)&&(this.isUpdatingFs||(this.isUpdatingResources=!0,this.batcher.batchIfNeeded((()=>{this.dispatch([e.path]),this.updateFileResource(e),this.updateDirectoryResource(e),this.updateFileListResource(e)})),this.batcher.isBatching(),this.isUpdatingResources=!1))},this.resourceListener=(e,t)=>{if(!this.isUpdatingResources){for(const t of e){const e=t.getId();this.isUpdatingFs=!0,t.getLatest()!==(0,o.textFileProvider)(this.fs,e)&&(this.setFileMetaLastModifiedOrigin(e,"WCS"),this.fs.writeFileSync(e,t.getLatest())),this.filesMtime.set(e,+this.fs.statSync(e).mtime),this.isUpdatingFs=!1}for(const e of t){const t=e.getId();e.isDeleted()&&this.fs.existsSync(t)&&(this.setFileMetaLastModifiedOrigin(t,"WCS"),this.fs.removeSync(t)),e.isDeleted()||this.fs.existsSync(t)||(this.setFileMetaLastModifiedOrigin(t,"WCS"),this.fs.writeFileSync(t,e.getLatest()))}this.dispatch([...e].map((e=>e.getId())))}},this.updateFileListResource=({stats:e})=>{(!e||(null==e?void 0:e.mtime.getTime())-(null==e?void 0:e.birthtime.getTime())<=6e4)&&this.fileListManager.reEvaluateValue(this.directoryPath)},this.updateFileResource=({path:e,stats:t})=>{var i;if(t){if(!t.isDirectory()&&this.fileManager.isOpen(e)){const t=this.fileManager.get(e);t.isValid()||t.restore();const s=+this.fs.statSync(e).mtime,r=this.filesMtime.get(e);(!r||r<s)&&(null===(i=this.fileMetaManager)||void 0===i||i.get(e).applyChange((0,a.fullChange)({lastModifiedOrigin:"External"})),this.fileManager.reEvaluateValue(e),this.filesMtime.set(e,s))}}else this.fileManager.isOpen(e)&&this.fileManager.get(e).invalidate("Deleted")},this.updateDirectoryResource=({path:e,stats:i})=>{const{dirname:a,basename:o}=this.fs,c=a(e),d=o(e),l=this.directoryManager.isOpen(c)?this.directoryManager.get(c):void 0;if(null===i)this.invalidateRemovedEntitiesResources(e),this.unwatchPath(e).catch(n.reportError),(null==l?void 0:l.isValid())&&l.applyChange({kind:s.DirectoryChangeKind.REMOVE,name:d});else{if(i.isDirectory()){const{files:i,directories:n}=(0,h.getDirectoryEntities)({directoryPath:e,fs:this.fs}),a=e=>({item:e,stats:this.fs.statSync(e.path)}),o=({item:e,stats:t})=>({name:e.name,stats:(0,r.fsStatsToResourceStats)(t)}),l=i.map(a),u=n.map(a);if(l.forEach((({item:{path:e},stats:t})=>{this.updateFileResource({path:e,stats:t})})),this.watchNestedDirectories(e).catch((()=>{const e=this.directoryManager.isOpen(c)?this.directoryManager.get(c):void 0;(null==e?void 0:e.isValid())&&e.applyChange({kind:s.DirectoryChangeKind.REMOVE,name:d})})),this.directoryManager.isOpen(e)){const i=this.directoryManager.get(e);i.isValid()||i.restore();const s=(0,t.getPartialUpdates)(i.getLatest(),[...l.map(o),...u.map(o)]);for(const e of s)i.applyChange(e)}}(null==l?void 0:l.isValid())&&(l.getLatest().some((e=>e.name===d))||l.applyChange({kind:s.DirectoryChangeKind.ADD,node:{name:d,stats:(0,r.fsStatsToResourceStats)(i)}}))}}}async init(){this.fs.watchService.addGlobalListener(this.fsListener),this.fileManager.subscribeDuringBatch(this.resourceListener),await this.watchNestedDirectories(this.directoryPath)}async dispose(){this.fs.watchService.removeGlobalListener(this.fsListener),this.fileManager.unsubscribeDuringBatch(this.resourceListener),await this.fs.watchService.unwatchAllPaths()}subscribeToFs(e){this.listeners.add(e)}unsubscribeFromFs(e){this.listeners.delete(e)}async watchPath(e){this.watchedDirectoriesPaths.has(e)||(this.watchedDirectoriesPaths.add(e),await this.fs.watchService.watchPath(e).catch(n.reportError))}async unwatchPath(e){this.watchedDirectoriesPaths.has(e)&&(this.watchedDirectoriesPaths.delete(e),await this.fs.watchService.unwatchPath(e).catch(n.reportError))}dispatch(e){for(const t of this.listeners)t(e)}setFileMetaLastModifiedOrigin(e,t){var i;null===(i=this.fileMetaManager)||void 0===i||i.get(e).applyChange((0,a.fullChange)({lastModifiedOrigin:t}))}invalidateRemovedEntitiesResources(e){this.fileManager.getOpenResources().map((e=>(0,a.deserializeId)(e))).filter((t=>t===e||t.startsWith(e+this.fs.sep))).forEach((e=>{this.fileManager.get(e).invalidate("Deleted")})),this.directoryManager.getOpenResources().map((e=>(0,a.deserializeId)(e))).filter((t=>t===e||t.startsWith(e+this.fs.sep))).forEach((e=>{this.directoryManager.get(e).invalidate("Deleted")}))}async watchNestedDirectories(e){const{directories:t}=this.directoryEntitiesService.getEntities({directoryPath:e});for(const{path:e}of t)await this.watchPath(e)}},t.isIdenticalDirEntity=(e,t)=>e.name===t.name&&e.stats.isDirectory===t.stats.isDirectory&&e.stats.isFile===t.stats.isFile&&e.stats.isDirectory===t.stats.isDirectory&&e.stats.isSymbolicLink===t.stats.isSymbolicLink,t.getPartialUpdates=(e,i)=>{const r=[...i],n=[];for(const i of e){const e=r.findIndex((e=>(0,t.isIdenticalDirEntity)(e,i)));-1!==e?r.splice(e,1):n.push({kind:s.DirectoryChangeKind.REMOVE,name:i.name})}return n.push(...r.map((e=>({kind:s.DirectoryChangeKind.ADD,node:e})))),n}},53863:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.directoryProvider=t.textFileProvider=void 0;const s=i(91394);t.textFileProvider=(e,t)=>e.readFileSync(t,"utf8").replace(/\r\n/g,"\n"),t.directoryProvider=(e,t)=>e.readdirSync(t,{withFileTypes:!0}).map((i=>{const r=e.join(t,i.name);return{name:i.name,stats:(0,s.fsStatsToResourceStats)(i),path:r}}))},91394:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.fsStatsToResourceStats=void 0,t.fsStatsToResourceStats=e=>({isFile:e.isFile(),isDirectory:e.isDirectory(),isSymbolicLink:e.isSymbolicLink()})},43482:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DirectoryEntitiesService=void 0;const s=i(18012);function r({fs:e,entities:t,filter:i,directoryPath:s}){return s&&i?t.filter((({path:t,name:r})=>n(s,t,e)&&i(t,r))):s?t.filter((({path:t})=>n(s,t,e))):i?t.filter((({path:e,name:t})=>i(e,t))):t}function n(e,t,i){const s=e+(""!==i.basename(e)?i.sep:"");return e===t||t.startsWith(s)}t.DirectoryEntitiesService=class{constructor(e,t,i){this.directoryPath=e,this.fs=t,this.pathPredicate=i,this.cachedResults=null,t.watchService.addGlobalListener((e=>this.invalidateOnDirectoryChange(e)))}invalidateOnDirectoryChange(e){this.pathPredicate(e.path)&&this.invalidateCache()}invalidateCache(){this.cachedResults=null}getEntities(e={}){const{directoryPath:t,filterDirectory:i,filterFile:n}=e;this.cachedResults||(this.cachedResults=(0,s.traverseFs)({directoryPath:this.directoryPath,fs:this.fs,filterDirectory:this.pathPredicate}));const{directories:a,files:o}=this.cachedResults;return{directories:r({fs:this.fs,entities:a,directoryPath:t,filter:i}),files:r({fs:this.fs,entities:o,directoryPath:t,filter:n})}}}},8407:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ProjectService=void 0;const s=i(93849),r=i(97648);t.ProjectService=class{constructor({fs:e,projectPath:t=e.cwd(),projectName:i="/",dualExtensions:r=[]}){this.events=new s.EventEmitter,this.fs=e,this.projectPath=t,this.projectName=i,this.dualExtensions=r}subscribe(e){this.events.subscribe("fileRenamed",e)}unsubscribe(e){this.events.unsubscribe("fileRenamed",e)}writeFile(e,t){const{dirname:i,writeFileSync:s,ensureDirectorySync:r}=this.fs;r(i(e)),s(e,t)}ensureFileExists(e){this.fs.fileExistsSync(e)||this.writeFile(e,"")}addFolder(e){this.fs.ensureDirectorySync(e)}getProjectPath(){return this.projectPath}getProjectName(){return this.projectName}removeEntity(e){this.fs.removeSync(e)}copy(e,t){const{copyDirectorySync:i,directoryExistsSync:s,ensureDirectorySync:n,copyFileSync:a,dirname:o}=this.fs,c=this.getCopyTargetPath(t);if(this.contains(e,c))throw new Error("destination inside source");s(e)?i(e,c):(n(o(c)),a(e,c,r.FileSystemConstants.COPYFILE_EXCL))}changeBaseName(e,t){const{join:i,dirname:s,renameSync:r}=this.fs,n=i(s(e),t);return r(e,n),this.events.emit("fileRenamed",{data:{filePath:n,oldFileName:e}}),n}moveEntity(e,t){const{basename:i,join:s,dirname:r,renameSync:n,fileExistsSync:a}=this.fs,o=a(t),c=i(e),h=s(o?r(t):t,c);if(!this.contains(e,h))try{return n(e,h),!0}catch(e){return!1}return!1}entityExists(e){return this.fs.existsSync(e)}isDirectory(e){return this.fs.directoryExistsSync(e)}join(...e){return this.fs.join(...e)}findClosestFile(e,t){return this.fs.findClosestFileSync(e,t)}findClosestPackage(e){const t=this.fs.findClosestFileSync(e,"package.json");if(t)return this.fs.dirname(t)}getCopyTargetPath(e){const{basename:t,join:i,dirname:s}=this.fs,r=this.getExtension(e),n=t(e,r);let a=e,o=1;for(;this.entityExists(a);)a=i(s(a),`${n}${o}${r}`),o++;return a}getExtension(e){for(const t of this.dualExtensions)if(e.endsWith(t))return t;return this.fs.extname(e)}contains(e,t){if(e===t)return!0;const{sep:i}=this.fs,s=e.split(i).filter((e=>e.length)),r=t.split(i).filter((e=>e.length));return s.every(((e,t)=>r[t]===e))}}},62868:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.UndoRedoService=void 0;const s=i(93849),r=i(60814),n=i(78204),a=i(91570);t.UndoRedoService=class{constructor(e,t,i,r){this.fileManager=e,this.fileMetaManager=t,this.navigationService=i,this.changesToUndo=[],this.changesToRedo=[],this.knownVersions={},this.isUndoingChanges=!1,this.isRedoingChanges=!1,this.events=new s.EventEmitter,this._isInitialized=!1,this.onFilesChange=(e,t)=>{const i={};let s="WCS";for(const t of e){const e=t.getCurrentVersion(),r=t.getId();s=this.getModificationOrigin(r);const n=this.getLastKnownVersion(r);(!n||e>n)&&(i[r]=t.getInvertingChangesFromVersion({ofVer:n||0})),this.setLastKnownVersion(r,e)}for(const e of t){const t=e.getId();t.endsWith(".compiled")||(s=this.getModificationOrigin(t),i[t]=void 0)}this.addToUndoStack(i,s),this.updateResource()},this.undoRedoStateResource=r.get(n.UNDO_REDO_RESOURCE_ID,this)}isInitialized(){return this._isInitialized}init(){this.fileManager.subscribeToAny(this.onFilesChange),this._isInitialized=!0}dispose(){this.fileManager.unsubscribeFromAny(this.onFilesChange),this.undoRedoStateResource.release(this)}addToUndoStack(e,t){const i={changeset:e,scope:this.scope,source:t};this.isUndoingChanges?this.changesToRedo.push(i):(this.pushNewAction(i),this.isRedoingChanges||(this.changesToRedo=[]))}undo(){const e=(0,a.last)(this.changesToUndo);if(e)return this.events.emit("undo",e),this.isUndoingChanges=!0,e.scope&&JSON.stringify(e.scope)!==JSON.stringify(this.scope)?(this.setScope(e.scope),this.navigationService.navigateToPanel(e.scope).catch(s.reportError)):(this.applyChangeset(e.changeset),this.isUndoingChanges=!1,this.changesToUndo.pop()),e.source}redo(){const e=(0,a.last)(this.changesToRedo);if(e)return this.events.emit("redo",e),this.isRedoingChanges=!0,e.scope&&JSON.stringify(e.scope)!==JSON.stringify(this.scope)?(this.setScope(e.scope),this.navigationService.navigateToPanel(e.scope).catch(s.reportError)):(this.applyChangeset(e.changeset),this.isRedoingChanges=!1,this.changesToRedo.pop()),e.source}setScope(e){this.scope=e}setLastKnownVersion(e,t){this.knownVersions[e]=t}getLastKnownVersion(e){return this.knownVersions[e]}pushNewAction(e){if(this.changesToUndo.length>0&&void 0!==this.changeBuffer){const t=this.changesToUndo[this.changesToUndo.length-1],i=new Set([...Object.keys(t.changeset),...Object.keys(e.changeset)]);if(JSON.stringify(t.scope)===JSON.stringify(e.scope)){const s={};for(const n of i){const i=r.stringManipulator.squasher([...e.changeset[n]||[],...t.changeset[n]||[]]);s[n]=i}return this.changesToUndo.pop(),this.changesToUndo.push({scope:t.scope,changeset:s,source:t.source}),clearTimeout(this.changeBuffer),void(this.changeBuffer=setTimeout((()=>{this.changeBuffer=void 0}),500))}}this.changesToUndo.push(e),this.changeBuffer=setTimeout((()=>{this.changeBuffer=void 0}),500)}applyChangeset(e){this.fileManager.getBatcher().runAtomic((()=>{for(const t of Object.keys(e)){const i=e[t];void 0===i?this.applyFileChange(t):this.applyStringChanges(t,i)}}))}applyFileChange(e){const t=this.fileManager.get(e);t.isDeleted()?t.restoreDeleted():t.delete()}applyStringChanges(e,t){for(const i of t)this.fileManager.get(e).applyChange(i)}updateResource(){this.undoRedoStateResource.applyChange((0,r.fullChange)({undoCount:this.changesToUndo.length,redoCount:this.changesToRedo.length}))}getModificationOrigin(e){return this.fileMetaManager.get(e).getLatest().lastModifiedOrigin}subscribeToUndo(e){this.events.on("undo",e)}unsubscribeToUndo(e){this.events.off("undo",e)}subscribeToRedo(e){this.events.on("redo",e)}unsubscribeToRedo(e){this.events.off("redo",e)}resetStacks(){this.changesToUndo=[],this.changesToRedo=[],this.updateResource()}}},98180:(e,t)=>{"use strict";var i;Object.defineProperty(t,"__esModule",{value:!0}),t.directoryManipulator=t.directoryReducer=t.DirectoryChangeKind=void 0,function(e){e.FULL="full",e.ADD="add",e.REMOVE="remove"}(i=t.DirectoryChangeKind||(t.DirectoryChangeKind={})),t.directoryReducer=(e,t)=>{switch(t.kind){case i.FULL:return{value:t.value,invertingChanges:[{kind:i.FULL,value:e}]};case i.ADD:return{value:[...e,t.node],invertingChanges:[{kind:i.FULL,value:e}]};case i.REMOVE:return{value:e.filter((e=>e.name!==t.name)),invertingChanges:[{kind:i.FULL,value:e}]};default:return{value:e,invertingChanges:[{kind:i.FULL,value:e}]}}},t.directoryManipulator={reducer:t.directoryReducer}},71299:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FileResource=void 0;const s=i(60814),r=i(78204);class n extends s.Resource{delete(){this.invalidate(r.FILE_RESOURCE_DELETE_MESSAGE)}restoreDeleted(){this.setStatus({valid:!0})}isDeleted(){return!this.isValid()&&this.getInvalidationMessage()===r.FILE_RESOURCE_DELETE_MESSAGE}}t.FileResource=n},61276:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FileScannerComputeHandler=t.getDirectoryEntities=t.traverseFs=void 0;const s=i(93849),r=i(98180);t.traverseFs=function e({directoryPath:t,fs:i,filterFile:r=s.returnsTrue,filterDirectory:n=s.returnsTrue,directories:a=[],files:o=[]}){const{readdirSync:c}=i;a.push({path:t,name:i.basename(t)});for(const s of c(t,{withFileTypes:!0})){const c=s.name,h=i.join(t,c);s.isDirectory()&&n(h,c)?e({directoryPath:h,fs:i,filterFile:r,filterDirectory:n,directories:a,files:o}):s.isFile()&&r(h,c)&&o.push({path:h,name:c})}return{directories:a,files:o}},t.getDirectoryEntities=function({directoryPath:e,fs:t}){const{readdirSync:i}=t,s={directories:[],files:[]};for(const r of i(e,{withFileTypes:!0})){const i=r.name,n=t.join(e,i);r.isDirectory()?s.directories.push({path:n,name:i}):r.isFile()&&s.files.push({path:n,name:i})}return s},t.FileScannerComputeHandler=class{constructor(e,t,i,s,r){this.controller=e,this.manipulator=t,this.fs=i,this.pathPredicate=s,this.directoryManager=r}compute(e){let t=this.controller.getEmptyValue();const{changes:i,dependencies:s}=this.addDirectory(e,t);for(const e of i)t=this.manipulator.reducer(t,e).value;return{value:t,dependencies:s,status:{valid:!0}}}recompute(e,t,i,s){const r=e.getLatest(),n=[];let a=new Set(s);for(const e of i){if(!e.isValid())continue;const i=e.getType(),{changes:s,dependencies:o}=this.getDirectoryRelatedUpdates(e,t[i][e.getSerializedId()],r,a);n.push(...s),a=o}const o=Array.from(s).filter((e=>!e.isValid()));return{dependencies:new Set([...a].filter((e=>!o.includes(e)))),changes:n,status:{valid:!0}}}addDirectory(e,t){const i=new Set,{files:s,directoryResources:r}=this.addDirRecurse(e),n=[],a=this.controller.onFilesAdded(t,s.map((({path:e})=>e)));return r.forEach((e=>i.add(e))),n.push(...a.changes),{changes:n,dependencies:i}}addDirRecurse(e,t=[],i=[],s=[]){const r=this.directoryManager.get(e);s.push(r);const n=r.getLatest();for(const r of n){const n={name:r.name,path:this.fs.join(e,r.name)};this.pathPredicate(n.path)&&(r.stats.isDirectory?(t.push(n),this.addDirRecurse(n.path,t,i,s)):r.stats.isFile&&this.controller.predicate(n.path)&&i.push(n))}return{files:i,directories:t,directoryResources:s}}getDirectoryRelatedUpdates(e,t,i,s){if(t.isDisposed())return{changes:[],dependencies:s};const n=[],a=new Set(s),o=e.getChangesFromVersion(t),c=e.getId();return o.forEach((e=>{if(e.kind===r.DirectoryChangeKind.ADD){const t=this.fs.join(c,e.node.name);if(e.node.stats.isDirectory){if(this.pathPredicate(t)){const{changes:e,dependencies:s}=this.addDirectory(t,i);for(const e of s)a.add(e);n.push(...e)}}else if(this.pathPredicate(t)&&this.controller.predicate(t)){const{changes:e}=this.controller.onFilesAdded(i,[t]);n.push(...e)}}else if(e.kind===r.DirectoryChangeKind.REMOVE){const t=this.fs.join(c,e.name);n.push(...this.controller.onRemoved(i,t))}})),{changes:n,dependencies:a}}}},33506:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.removePrefixPath=t.createPathPredicate=t.directoryDeepChildren=t.getPathsOfFilePath=t.getTreeNodePath=void 0;const s=i(71876),r=i(73654),n=i(91570);function a(e,t){return e.split(t).filter((e=>!!e))}function o(){return!0}t.getTreeNodePath=a,t.getPathsOfFilePath=function(e,t){var i;const s=e?a(e,t):[],r=[];for(let e=0;e<s.length;e++)r.push((null!==(i=r[e-1])&&void 0!==i?i:"")+t+s[e]);return r},t.directoryDeepChildren=async function*e(t,i,s=o,r=i){for(const n of await t.promises.readdir(i,{withFileTypes:!0})){const a=n.name,o=t.join(i,a),c=t.relative(r,o);if(n.isFile()){const e={type:"file",path:o,name:a,relativePath:c};s(e)&&(yield e)}else if(n.isDirectory()){const i={type:"directory",path:o,name:a,relativePath:c};s(i)&&(yield i,yield*e(t,o,s,r))}}},t.createPathPredicate=function(e,t,i){const r=i.map((e=>(0,s.makeRe)(e)));return i=>{const s=e.relative(t,i);return!r.some((e=>e.test(s)))}},t.removePrefixPath=(e,t)=>e?(0,n.replaceWinSlashes)(r.win32.relative(e,t)):(0,n.replaceWinSlashes)(t)},18012:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i(5163);s.__exportStar(i(78204),t),s.__exportStar(i(98180),t),s.__exportStar(i(33506),t),s.__exportStar(i(98073),t),s.__exportStar(i(61276),t)},98073:(e,t)=>{"use strict";var i,s;Object.defineProperty(t,"__esModule",{value:!0}),t.NodeType=t.FsEventType=void 0,(s=t.FsEventType||(t.FsEventType={}))[s.CREATE=0]="CREATE",s[s.LOAD=1]="LOAD",s[s.UPDATE=2]="UPDATE",s[s.DELETE=3]="DELETE",(i=t.NodeType||(t.NodeType={}))[i.directory=0]="directory",i[i.file=1]="file",i[i.virtual=2]="virtual",i[i.none=3]="none"},60814:(e,t,i)=>{e.exports=i(73858)}}]);