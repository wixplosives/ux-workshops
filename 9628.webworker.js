(self.webpackChunk_wixc3_component_playground=self.webpackChunk_wixc3_component_playground||[]).push([[9628],{25634:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.demoConvertor=t.getPropInitializerFromDemoNode=void 0;const n=i(5163).__importDefault(i(60270)),o=i(8260);function r(e,t){const i=e.find((e=>{var i;return(null===(i=e.name)||void 0===i?void 0:i.getText())===t}));return i&&n.default.isPropertyAssignment(i)?i:void 0}function s(e,t){return function(e,t){const i=r(e,t);return null==i?void 0:i.initializer}(e.expression.arguments[0].properties,t)}function a(e){if(!e.expression||!n.default.isCallExpression(e.expression))return;if(!e.expression.expression||!n.default.isIdentifier(e.expression.expression))return;if("createBoard"!==e.expression.expression.text)return;if(1!==e.expression.arguments.length)return;const t=e.expression.arguments[0];return n.default.isObjectLiteralExpression(t)?t:void 0}t.getPropInitializerFromDemoNode=s,t.demoConvertor={language:"typescript",kind:"demo",isApplicable:e=>{if(!n.default.isExportAssignment(e))return!1;const t=a(e);if(!(null==t?void 0:t.properties))return!1;const i=r(t.properties,"name");if(!i||!n.default.isStringLiteral(i.initializer))return!1;const o=r(t.properties,"props");if(o&&!n.default.isObjectLiteralExpression(o.initializer))return!1;const s=r(t.properties,"environmentProps");return!(s&&!n.default.isObjectLiteralExpression(s.initializer))&&!!r(t.properties,"Board")},convert(e,t){const i=s(e,"props"),n=s(e,"environmentProps"),o=s(e,"name"),r=s(e,"Board");return{kind:"demo",astNodeId:t.getNodeId(e),name:t.convertLeaf(o),demo:t.convertLeaf(r),props:i&&t.convertLeaf(i),environmentProps:n&&t.convertLeaf(n)}},modifications:{addEnvironmentProps(e,t,{propertyId:i,name:n,value:r}){const s=e.expression.arguments[0];return o.objectConvertor.modifications.addProperty(s,t,{name:n,value:r,propertyId:i})},setName(e,t,{name:i}){const s=a(e);if(!s)throw new Error("Cannot set name on invalid demo node");const d=r(s.properties,"name");if(!d||!n.default.isStringLiteral(d.initializer))throw new Error("Cannot set name on invalid demo node");return o.stringConvertor.modifications.setValue(d.initializer,t,{value:i})},removeProps(e,t){const i=a(e),n=null==i?void 0:i.properties.find((e=>{var t;return"props"===(null===(t=e.name)||void 0===t?void 0:t.getText())})),r=n&&t.getNodeID(n);return i&&r?o.objectConvertor.modifications.removeProperty(i,t,{childId:r}):[]}},defaultConfig:{}}},91788:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),i(5163).__exportStar(i(25634),t)},11320:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.demoAstParsers=void 0;const n=i(26709),o=i(9240);t.demoAstParsers=[...o.commonSimpleAstParsers,n.demoPlugin].map((e=>e.nodeKind))},4601:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=i(5163);n.__exportStar(i(73676),t),n.__exportStar(i(11320),t),n.__exportStar(i(59114),t)},73676:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.simulationAstParsers=void 0;const n=i(26709),o=i(9240),r=i(30802);t.simulationAstParsers=[...o.commonSimpleAstParsers,r.simulationPlugin,n.demoPlugin].map((e=>e.nodeKind))},59114:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},51321:(e,t,i)=>{e.exports=i(4601)},8260:(e,t,i)=>{e.exports=i(45856)},79628:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=i(5163);n.__exportStar(i(77689),t),n.__exportStar(i(61375),t),n.__exportStar(i(24297),t),n.__exportStar(i(42682),t),n.__exportStar(i(95919),t),n.__exportStar(i(42146),t)},42682:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.jsxFileConvertor=void 0;const n=i(5163).__importDefault(i(60270)),o=i(8260),r=i(42146),s=i(64200),a=i(95919),d=i(13445),l=i(91788),u=i(40977),p=i(73654),c=i(91570);function f(e,t,i){return i?r.jsxOwnerFunctionConvertor.isApplicable(e,t):n.default.isFunctionLike(e)&&0===(0,s.getScopeJsxRoots)(e,t).length}const m=(e,t,i)=>{const n=(0,s.flattenParents)(e),r=n.find((e=>f(e,t,i)));if(r)return r;const a=[...n].reverse(),d=a.find((e=>f(e,t,i)));if(d)return d;if(!i)return;return a.find((e=>(0,o.isNamedDeclaration)(e)))||n[1]};function g(e){return(0,c.isRelativeImportPath)(e.text)||(0,c.isRelativeModulePath)(e.text)}t.jsxFileConvertor={language:"typescript",isApplicable:e=>n.default.isSourceFile(e),convert(e,t){const i=new Set,u=new Set,p=new Set,c=new Set,g=new Set;return(0,o.visitAstAndBreak)(t.lang.getChildren,e,(e=>{if(d.simulationConvertor.isApplicable(e,t)&&p.add(e),l.demoConvertor.isApplicable(e,t)){c.add(e);const i=e,n=(0,l.getPropInitializerFromDemoNode)(i,"Board"),o=t.idService.nodesToIds.get(n);g.add(o)}if((0,s.isJsxNode)(e)){const n=m(e,t,!0);if(n){const e=t.idService.nodesToIds.get(n);return g.has(e)||i.add(n),!1}}if(n.default.isReturnStatement(e)&&e.expression){const i=m(e.expression,t,!1);i&&u.add(i)}return!0})),{kind:"jsx-file",astNodeId:t.getNodeId(e),owners:[...i].flatMap((e=>f(e,t,!0)?r.jsxOwnerFunctionConvertor.convert(e,t):a.jsxOwnerConvertor.convert(e,t))),simulations:[...p].flatMap((e=>d.simulationConvertor.convert(e,t))),demos:[...c].flatMap((e=>l.demoConvertor.convert(e,t))),nonJsxOwners:[...u].flatMap((e=>f(e,t,!1)?r.jsxOwnerFunctionConvertor.convert(e,t):a.jsxOwnerConvertor.convert(e,t)))}},kind:"jsx-file",modifications:{moveNode:u.moveNode,updateModuleSpecifiersForPathChange(e,t,{sourceFilePath:i,targetFilePath:r}){const s=p.win32.dirname(i),a=p.win32.dirname(r);return s===a?[]:e.statements.filter(n.default.isImportDeclaration).sort(((e,t)=>t.getEnd()-e.getEnd())).map((e=>e.moduleSpecifier)).filter(n.default.isStringLiteral).filter(g).flatMap((e=>{const i=e.text,n=p.posix.resolve(s,i),a=(0,c.rebaseRelativeModulePath)(r,n);return o.stringConvertor.modifications.setValue(e,t,{value:a})}))}},defaultConfig:{}}},42146:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.jsxOwnerFunctionConvertor=void 0;const n=i(5163).__importDefault(i(60270)),o=i(56284),r=i(8260),s=i(64200),a=i(9240),d=e=>n.default.isFunctionLike(e)?e:d(e.parent),l=(e,t)=>t.parent?t.parent===e?t:l(e,t.parent):t,u=(e,t)=>t.parent&&t!==e?n.default.isIfStatement(t)?[t.expression,...u(e,t.parent)]:n.default.isCaseClause(t)?[t,...u(e,t.parent)]:u(e,t.parent):[];t.jsxOwnerFunctionConvertor={language:"typescript",isApplicable:(e,t)=>n.default.isFunctionLike(e)&&(0,s.getScopeJsxRoots)(e,t).length>0,convert(e,t){const i=new Set,a=new Set;n.default.isArrowFunction(e)&&!n.default.isBlock(e.body)?a.add(e.body):(0,r.visitAstAndBreak)(t.lang.getChildren,e,(t=>{if(t===e)return!0;if(n.default.isReturnStatement(t)&&d(t)===e){if(t.expression)return a.add(t.expression),!1}else if((0,s.isJsxNode)(t)||n.default.isVariableDeclaration(t))return i.add(t),!1;return!0}));const p=(null==e?void 0:e.body)||e,c=[...i].reduce(((e,t)=>(e.add(l(p,t)),e)),new Set);return(0,o.createJsxOwnerFunction)({astNodeId:t.getNodeId(e),names:(0,s.getNames)(e,t),nonReturnRoots:[...c].map((e=>t.convert(e))).flat(),returnRoots:[...a].map((e=>({conditions:u(p,e).map((e=>({astNodeId:t.getNodeId(e),code:e.getText()}))),returnValue:t.convertLeaf(e)}))).flat()})},kind:"jsx-function",modifications:{addChild(e,t,i){if(!(0,a.isAddInsteadModArgs)(i))throw new Error("jsx-owner-function only supports add-instead");const n=t.getNodeByID(i.insteadOfChildId);if(!n)throw new Error(`can't find child with id: ${i.insteadOfChildId}`);return[{from:n.getFullStart(),to:n.getEnd(),newContent:t.generate(i.newChild),removedIds:[i.insteadOfChildId]}]}},defaultConfig:{}}},95919:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.jsxOwnerConvertor=t.getOwnerRoots=void 0;const n=i(5163).__importDefault(i(60270)),o=i(8260),r=i(34249),s=i(64200);t.getOwnerRoots=(e,t)=>{const i=[];(0,o.visitAstAndBreak)(t.lang.getChildren,e,(t=>t===e||!(0,s.isJsxNode)(t)||(i.push(t),!1)));const r=new Set;for(const t of i){const i=(0,s.flattenParents)(t,e).find((e=>n.default.isConditionalExpression(e)));i?r.add(i):r.add(t)}return r},t.jsxOwnerConvertor={language:"typescript",isApplicable:()=>!1,convert(e,i){const n=(0,t.getOwnerRoots)(e,i);return(0,r.createJsxOwner)({astNodeId:i.getNodeId(e),names:(0,s.getNames)(e,i),roots:[...n].map((e=>i.convertLeaf(e)))})},kind:"jsx-owner",modifications:{},defaultConfig:{}}},64200:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getScopeJsxRoots=t.getNames=t.flattenParents=t.isJsxNode=void 0;const n=i(5163),o=i(8260),r=n.__importDefault(i(60270));function s(e){return r.default.isJsxElement(e)||r.default.isJsxSelfClosingElement(e)||r.default.isJsxFragment(e)}t.isJsxNode=s,t.flattenParents=(e,i,n=[])=>e.parent&&(n.unshift(e),e.parent!==i)?(0,t.flattenParents)(e.parent,i,n):n,t.getNames=(e,i)=>[...(0,t.flattenParents)(e.parent),e].filter((e=>(0,o.isNamedDeclaration)(e)&&e.name)).map((e=>({astNodeId:i.getNodeId(e),name:e.name.getText()}))),t.getScopeJsxRoots=(e,t)=>{const i=[];return(0,o.visitAstAndBreak)(t.lang.getChildren,e,(t=>s(t)?(i.push(t),!1):e===t||!r.default.isFunctionLike(t))),i}},65432:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EnvPropsComputeHandler=void 0;const n=i(9240),o=i(60814),r=i(30802),s=i(26709);t.EnvPropsComputeHandler=class{constructor(e,t){this.simpleAstManager=e,this.simpleASTPluginRepo=t}compute(e){const t=this.simpleAstManager.get({filePath:e,parsers:[...this.simpleASTPluginRepo.getPlugins().values(),s.demoPlugin,r.simulationPlugin].map((e=>e.nodeKind))}),i=new Set([t]),n=this.getEnvironmentPropsNode(t);return n?{value:a(n),dependencies:i}:{value:{},dependencies:i}}getEnvironmentPropsNode(e){const t=(0,n.findNode)(e.getLatest(),this.simpleASTPluginRepo.getPlugins(),(e=>(0,r.isSimulationNode)(e)||(0,s.isDemoNode)(e)));return(0,s.isDemoNode)(t)?t.environmentProps:void 0}recompute(e){const{value:t,dependencies:i}=this.compute(e.getId());return{changes:t?[(0,o.fullChange)(t)]:[],dependencies:i,status:{valid:!0}}}};const a=e=>{const t={};return(0,n.isObjectNode)(e)&&e.properties.forEach((e=>{if((0,n.isPropertyNode)(e)&&(0,n.isStringNode)(e.name)){const i=e.name.value;((0,n.isNumberNode)(e.initializer)||(0,n.isStringNode)(e.initializer)||(0,n.isBooleanNode)(e.initializer))&&(t[i]=e.initializer.value),(0,n.isObjectNode)(e.initializer)&&(t[i]=a(e.initializer))}})),t}},77689:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),i(5163).__exportStar(i(65432),t)},24297:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),i(5163).__exportStar(i(34652),t)},34652:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SimulationProcessingService=t.getDemoContent=void 0;const n=i(91570),o=i(9240),r=i(8260),s=i(51321),a=i(3092),d=i(26709);t.getDemoContent=(e,t,i,s)=>{const a=(0,o.getComponentName)(t,i),d="default"===i?a:`{ ${a} }`,l=t.replace(/\\/g,"/"),u=s?"'":'"';return`import React from 'react';\nimport { createBoard } from ${u}@wixc3/react-board${u};\nimport ${d} from ${u}${(0,n.getImportPath)(l)}${u};\n\nexport default createBoard({\n    name: ${u}${(s?r.escapeSingleQuote:r.escapeDblQuote)(e)}${u},\n    Board: () => <${a} />\n});\n`},t.SimulationProcessingService=class{constructor(e){this.options=e,this.envBacther=e.simpleAstManager.batcher}createDemo(e,i,o){var r,s;if(this.options.projectService.fs.fileExistsSync(e))throw new Error(`Cannot create Demo at path: ${e}, a file with the same name already exists there.`);const{filePath:d,exportName:l}=(0,a.getComponentRefObject)(o);let u=this.options.projectService.fs.relative(this.options.projectService.fs.dirname(e),d);(0,n.isRelativeModulePath)(u)||(u=`./${u}`),this.options.projectService.writeFile(e,(0,t.getDemoContent)(i,u,l,!(null===(s=null===(r=this.options.editorConfig)||void 0===r?void 0:r.formatSettings)||void 0===s?void 0:s.doubleQuotes)))}async copySimulation(e,t,i){if(this.options.projectService.fs.fileExistsSync(t))throw new Error(`Cannot create simulation at path: ${t}, a file with the same name already exists there.`);this.options.projectService.copy(e.filePath,t);const r=this.options.simpleAstManager.get({filePath:t,parsers:[...this.options.simpleASTPluginRepo.getPlugins().values()].map((e=>e.nodeKind))});await r.waitForValid(),await(0,n.newMacrotask)(),this.envBacther.batchAll((()=>{const n=r.getLatest(),s=(0,o.findNode)(n,this.options.simpleASTPluginRepo.getPlugins(),d.isDemoNode),a=[];if(a.push(r.getModification(n,"updateModuleSpecifiersForPathChange",{sourceFilePath:e.filePath,targetFilePath:t})),(0,d.isDemoNode)(s)&&i&&s.name.value!==i&&a.push(r.getModification(s.name,"setValue",{value:i})),a.length)for(const e of a)r.applyModification({kind:e.nodeKind,astNodeId:e.targetId},e.modification,e.modificationArgs)}))}renameDemo(e,t){const i=this.options.simpleAstManager.get({filePath:e.filePath,parsers:s.simulationAstParsers}),n=(0,a.getDemoNode)(i);if(!n)throw new Error(`Simulation node not found in ${e.filePath}`);const o=i.getModification(n,"setName",{name:t});i.applyModification({kind:o.nodeKind,astNodeId:o.targetId},o.modification,o.modificationArgs)}deleteSimulations(e){this.envBacther.batchAll((()=>{for(const t of e)this.options.projectService.removeEntity(t.filePath)}))}getSimPropPositionInFile(e,t){const i=this.options.sourceIdResourceManager.get(e.filePath),n=e=>i.getLatest()[e],{filePath:r}=e,d=this.options.simpleAstManager.get({filePath:r,parsers:s.simulationAstParsers}),l=(0,a.getSimulationNode)(d);if(!l)throw new Error(`Simulation node not found in ${e.filePath}`);const u=(0,o.getSimpleObjectProp)(l.data.properties,"props");if(!u)return{from:n(l.astNodeId).end,length:0};if(!(0,o.isObjectNode)(u.initializer))return{from:n(u.initializer.astNodeId).end,length:0};const p=(0,o.getSimpleObjectProp)(u.initializer.properties,t);if(!p)return{from:n(u.initializer.astNodeId).end,length:0};const c=n(p.astNodeId);if(!(0,o.isPropertyNode)(p))return{from:c.start,length:c.end-c.start};const f=n(p.initializer.astNodeId);return{from:f.start,length:f.end-f.start}}async waitForDependencyResourcesToUpdate({filePath:e}){const t=this.options.simpleAstManager.get({filePath:e,parsers:s.simulationAstParsers});await new Promise((e=>t.subscribeOnce(e)))}getSimulationLocation(e){const{filePath:t}=e,i=this.options.simpleAstManager.get({filePath:t,parsers:s.simulationAstParsers}),n=(0,a.getSimulationNode)(i);if(n)return{fileName:t,astNodeId:n.astNodeId}}}},61375:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getSimulationIdAndName=void 0;const n=i(9240),o=i(30802);t.getSimulationIdAndName=e=>{const{simpleAstResource:t,assets:i,resolveRequest:r,fs:s}=e,a=t.getId().filePath;if(!i.getFilesWithTag(o.SIMULATION_FILE_TAG).includes(a))throw new Error(`Cannot find simulation in file ${a} - no default export`);const d=t.getLatest();if(!(0,n.isNodeOfKind)("root",d))throw new Error(`Cannot find simulation in file ${a}`);const l=d.statements.find((e=>(0,n.isNodeOfKind)("simulation",e)));if(!l||!(0,n.isNodeOfKind)("simulation",l))throw new Error(`Cannot find simulation in file ${a}`);const u=(0,n.getSimpleObjectProp)(l.data.properties,"componentType");if(!u)throw new Error(`Cannot find component type in simulation ${a}`);const p=u.initializer;if(!p||!(0,n.isSimpleFileReferenceNode)(p))throw new Error(`Component type is not a valid reference in simulation ${a}`);const{resolvedFile:c}=r(s.dirname(a),p.targetFile);if(!c)throw new Error(`Component type is not a valid reference in simulation ${a}`);const f=(0,n.getSimpleObjectProp)(l.data.properties,"name").initializer;if(!f||!(0,n.isNodeOfKind)("string",f))throw new Error(`Cannot find simulation name in simulation ${a}`);return{id:{componentTypeRef:`${c}#${p.targetExport}`,filePath:a},name:f.value}}},90129:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),i(5163).__exportStar(i(96560),t)},96560:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.simulationConvertor=void 0;const n=i(5163).__importDefault(i(60270));function o(e,t){const i=e.find((e=>{var i;return(null===(i=e.name)||void 0===i?void 0:i.getText())===t}));return i&&n.default.isPropertyAssignment(i)?i:void 0}t.simulationConvertor={language:"typescript",kind:"simulation",isApplicable:e=>{if(!n.default.isExportAssignment(e))return!1;if(!e.expression||!n.default.isCallExpression(e.expression))return!1;if(!e.expression.expression||!n.default.isIdentifier(e.expression.expression))return!1;if("createSimulation"!==e.expression.expression.text)return!1;if(1!==e.expression.arguments.length)return!1;const t=e.expression.arguments[0];if(!n.default.isObjectLiteralExpression(t))return!1;const i=o(e.expression.arguments[0].properties,"name");if(!i||!n.default.isStringLiteral(i.initializer))return!1;const r=o(t.properties,"props");return!(!r||!n.default.isObjectLiteralExpression(r.initializer))&&!!o(t.properties,"componentType")},convert:(e,t)=>({kind:"simulation",astNodeId:t.getNodeId(e),data:t.convertLeaf(e.expression.arguments[0])}),modifications:{},defaultConfig:{}}},13445:(e,t,i)=>{e.exports=i(90129)}}]);