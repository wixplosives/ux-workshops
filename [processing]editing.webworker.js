(self.webpackChunk_wixc3_component_playground=self.webpackChunk_wixc3_component_playground||[]).push([[6319],{74561:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(5163),s=r(2206),i=n.__importDefault(r(89706)),a=r(69144),o=r(66129),c=r(93036),d=r(9234),l=r(91570);i.default.setup(s.processingEnv,(({elementsSchemasManager:e,safeModeConfig:t,scopeSchemasManager:r},{simpleAST:{simpleAST:n,languageASTPlugin:i,languageASTFallbackPlugin:u,idService:p,simpleASTPluginRepo:h},typescript:{compilationTransformers:g,languageIntellisense:f},symbolSchemaExtract:{schemaService:m},project:{projectService:v,fileManager:y,pluggableProjectConfig:S,ignoredSubPathsConfig:P},codeExecution:{fileDependencyResourceFactory:C}})=>{var _;i.register(c.renderSimulationConvertor),u.register(c.unparsedWithRootsConvertor);const D=S.get(s.PROJECT_CONFIG_NAME),x=D.isValid()?D.get(t):{},E=(0,c.jsonToSafeModeConfig)(x);g.register({before:[(0,o.reactDevTransformer)({safeMode:{errorRenderer:{module:"@wixc3/editing-feature/dist/preview/error-renderer",exportName:"createErrorRenderer"},components:!0,expressions:!0,errorBoundariesForComponents:!0,maxInstancesPerComponent:null!==(_=E.maxInstancesPerComponent)&&void 0!==_?_:100},idByPosition:({fileName:e,pos:t,end:r,tsNodeKind:n})=>{const s=(0,l.formatToOSpaths)(e),i=p.getFileAPI(s).getUnderlyingIDService().idsToNodes;for(const e of i.keys()){const s=i.get(e);if(s.kind===n&&s.getStart()===t&&s.getStart()+s.getWidth()===r)return e}return"unknown"}})]});const R=D.isValid()?D.get(P):s.DEFAULT_IGNORED_SUBPATHS,T=(0,a.createPathPredicate)(v.fs,v.getProjectPath(),R),w=e.provide({dependencies:[n,y,C],handler:new c.ElementsSchemasComputeHandler(m,n,p,f,y,C,T,500,2e3),resourceConstructor:d.SchemasResource});return{elementsSchemasManager:w,scopeSchemasManager:r.provide({dependencies:[n,w],handler:new c.ScopesSchemasComputeHandler(n,w,h),resourceConstructor:d.SchemasResource})}}))},9234:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SchemasResource=void 0;const n=r(37894),s=r(60814),i=new WeakMap;class a extends s.JSONResource{getSchemas(){const e=this.getLatest();return e&&e.schemas&&!i.has(e.schemas)&&i.set(e.schemas,(0,n.getInlinedSchemasFromSchemaBlob)(e.schemas)),e&&e.schemas?i.get(e.schemas):null}}t.SchemasResource=a},93036:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(5163);n.__exportStar(r(38283),t),n.__exportStar(r(38719),t),n.__exportStar(r(62714),t),n.__exportStar(r(17165),t)},38283:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.renderSimulationConvertor=void 0;const n=r(5163).__importDefault(r(60270)),s=r(8260),i=r(9240),a=r(57797);t.renderSimulationConvertor={language:"typescript",isApplicable:(e,t)=>{let r=!1;return n.default.isJsxExpression(e)&&(0,s.visitAstAndBreak)(t.lang.getChildren,e,(e=>{var t;return!n.default.isCallExpression(e)||!(n.default.isPropertyAccessExpression(e.expression)&&"renderSimulation"===(null===(t=e.expression.name)||void 0===t?void 0:t.getText())||"renderSimulation"===e.expression.getText())||(r=!0,!1)})),r},convert:(e,t)=>(0,a.createRenderSimulation)({astNodeId:t.getNodeId(e),code:e.getText()}),generate:e=>[(0,i.startNode)(e.astNodeId),e.code,(0,i.endNode)(e.astNodeId)],kind:"render-simulation",modifications:{},defaultConfig:{}}},38719:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.unparsedWithRootsConvertor=void 0;const n=r(9240),s=r(8260);t.unparsedWithRootsConvertor={language:"typescript",isApplicable:(e,r)=>!r.getPassConvertors(t.unparsedWithRootsConvertor).find((t=>t.isApplicable(e))),convert(e,t){const r=new Set,i=[...t.getConvertors(this)],a=i.indexOf(this);-1!==a&&i.splice(a,1),(0,s.visitAstAndBreak)(t.lang.getChildren,e,(n=>e===n||(i.find((e=>e.isApplicable(n,t)))?(r.add(n),!1):!(0,s.isReferencableDeclaration)(n)||(r.add(n),!1))));const o=(0,n.createUnparsedWithRoots)({astNodeId:t.getNodeId(e),code:e.getText(),roots:[...r].map((e=>t.convert(e))).flat()});return(0,s.isReferencableDeclaration)(e)&&e.name&&(o.name=e.name.getText()),o},generate:e=>[(0,n.startNode)(e.astNodeId),e.code,(0,n.endNode)(e.astNodeId)],kind:"unparsed-with-roots",modifications:{},defaultConfig:{}}},62714:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ScopesSchemasComputeHandler=t.ElementsSchemasComputeHandler=void 0;const n=r(5163).__importDefault(r(60270)),s=r(60814),i=r(9240),a=r(91570),o=r(30802),c=r(98066),d=r(26709),l=[c.jsxFilePlugin,c.jsxOwnerPlugin,c.jsxFunctionPlugin,i.jsxPlugin,i.jsxExpressionPlugin,i.jsxTextPlugin,i.variablePlugin,i.unparsedWithRootsPlugin,i.objectPlugin,i.referencePlugin,d.demoPlugin];t.ElementsSchemasComputeHandler=class{constructor(e,t,r,n,s,i,o,c,d){this.schemaService=e,this.simpleAstResourceManager=t,this.idService=r,this.languageIntellisense=n,this.fileManager=s,this.fileDependenciesManager=i,this.applicableDependencyPathPredicate=o,this.debouncer=new a.Debouncer(this.compute.bind(this),c,d)}async compute(e,t){const{filePath:r,astNodeIds:n}=e,i=this.languageIntellisense.getLanguageController(r,t).languageService.getProgram(),o=null==i?void 0:i.getSourceFile(r),c=null==i?void 0:i.getTypeChecker(),d=(await this.simpleAstResourceManager.getReady({filePath:r,parsers:l.map((e=>e.nodeKind))},this)).getLatest(),h=await this.fileDependenciesManager.getReady(r),g=new Set([h]);if(!o||!c)return{status:{valid:!1,message:`Can't get typecheck for file ${r}`},value:null,dependencies:g};const f=new Set([r]),m=this.idService.getFileAPI(r),v=u(d,m,o,c,n),y=[],S=new Map,P={};v.forEach((([e,t])=>{const n=S.get(t);if(void 0!==n)P[e]=n;else{const n=y.length;y.push({filePath:r,type:t}),S.set(t,n),P[e]=n}}));const C=this.schemaService.getSchemasForAllTsTypesAsBlob(y,!1,!0);for(const[,e]of v)e&&p(e,f);for(const e of Object.values(h.getLatest()))e&&f.add(e);return f.forEach((e=>{this.applicableDependencyPathPredicate(e)&&a.isTypeAffectingFileOrDir&&g.add(this.fileManager.get(e))})),{value:{schemas:C,ids:P},dependencies:g,status:(0,s.getDefaultStatusHandling)(e,g)}}async recompute(e,t,r,n){const{value:i,dependencies:a}=await this.debouncer.trigger(e.getId(),e);return{changes:[(0,s.fullChange)(i)],dependencies:a,status:(0,s.getDefaultStatusHandling)(e.getSerializedId(),a)}}};const u=(e,t,r,s,a)=>{const o=new Map,c=new Set(a);return(0,i.walkProjectedNodes)(e,new Map(l.map((e=>[e.nodeKind,e]))),(e=>{if(c.has(e.astNodeId)&&(c.delete(e.astNodeId),(0,i.isNodeOfKind)("jsx-element",e))){const i=function(e,t,r,s){const i=e.getNodeByID(t);if(!i)return;const a=n.default.getTokenAtPosition(r,i.pos),o=n.default.findAncestor(a,(e=>n.default.isObjectLiteralExpression(e)||e.parent&&n.default.isJsxOpeningElement(e.parent)||e.parent&&n.default.isJsxSelfClosingElement(e.parent)));return s.getContextualType(o||a)}(t,e.astNodeId,r,s);i&&o.set(e.astNodeId,i)}return c.size>0})),Array.from(o.entries())},p=(e,t)=>{const r=e=>{e.getProperties().forEach((e=>{var r;return null===(r=e.getDeclarations())||void 0===r?void 0:r.forEach((e=>{t.add(e.getSourceFile().fileName)}))}))};return e.isIntersection()?e.types.forEach(r):r(e),t};function h(e,t,r,n){const s=new Set;return n.walkNodes(t,(t=>{if(r.indexOf(t.kind)>-1&&s.add(t),(0,i.isSimpleReferenceNode)(t)&&t.targetId){const i=e.owners.find((e=>e.names.find((e=>e.astNodeId===t.targetId))));i&&h(e,i,r,n).forEach((e=>s.add(e)))}return!0})),Array.from(s)}t.ScopesSchemasComputeHandler=class{constructor(e,t,r){this.simpleAstResourceManager=e,this.schemaRm=t,this.repo=r}async compute({filePath:e,astNodeId:t}){var r;const n=await this.simpleAstResourceManager.getReady({filePath:e,parsers:l.map((e=>e.nodeKind))}),s=n.getLatest();if(!(0,c.isJsxFile)(s))return{status:{valid:!1,message:"ast resource is not a JsxFile"},dependencies:new Set([n]),value:null};const a=null===(r=this.repo.findNode(s,t))||void 0===r?void 0:r.node;if(!a)return{status:{valid:!1,message:"scope not found"},dependencies:new Set([n]),value:null};const d=h(s,a,[i.jsxPlugin.nodeKind,o.simulationPlugin.nodeKind],this.repo),u=await this.schemaRm.getReady({filePath:e,astNodeIds:d.map((e=>e.astNodeId))});return{value:u.getLatest(),dependencies:new Set([u,n])}}async recompute(e,t,r,n){const{value:i,dependencies:a}=await this.compute(e.getId());return{changes:[(0,s.fullChange)(i)],dependencies:a,status:(0,s.getDefaultStatusHandling)(e.getSerializedId(),a)}}}},17165:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.jsonToSafeModeConfig=void 0,t.jsonToSafeModeConfig=function(e){const t={},{maxInstancesPerComponent:r}=e;return"number"==typeof r&&(t.maxInstancesPerComponent=r),t}},57797:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createRenderSimulation=void 0,t.createRenderSimulation=function(e){return{kind:"render-simulation",...e}}},98180:(e,t)=>{"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0}),t.directoryManipulator=t.directoryReducer=t.DirectoryChangeKind=void 0,function(e){e.FULL="full",e.ADD="add",e.REMOVE="remove"}(r=t.DirectoryChangeKind||(t.DirectoryChangeKind={})),t.directoryReducer=(e,t)=>{switch(t.kind){case r.FULL:return{value:t.value,invertingChanges:[{kind:r.FULL,value:e}]};case r.ADD:return{value:[...e,t.node],invertingChanges:[{kind:r.FULL,value:e}]};case r.REMOVE:return{value:e.filter((e=>e.name!==t.name)),invertingChanges:[{kind:r.FULL,value:e}]};default:return{value:e,invertingChanges:[{kind:r.FULL,value:e}]}}},t.directoryManipulator={reducer:t.directoryReducer}},61276:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FileScannerComputeHandler=t.getDirectoryEntities=t.traverseFs=void 0;const n=r(93849),s=r(98180);t.traverseFs=function e({directoryPath:t,fs:r,filterFile:s=n.returnsTrue,filterDirectory:i=n.returnsTrue,directories:a=[],files:o=[]}){const{readdirSync:c}=r;a.push({path:t,name:r.basename(t)});for(const n of c(t,{withFileTypes:!0})){const c=n.name,d=r.join(t,c);n.isDirectory()&&i(d,c)?e({directoryPath:d,fs:r,filterFile:s,filterDirectory:i,directories:a,files:o}):n.isFile()&&s(d,c)&&o.push({path:d,name:c})}return{directories:a,files:o}},t.getDirectoryEntities=function({directoryPath:e,fs:t}){const{readdirSync:r}=t,n={directories:[],files:[]};for(const s of r(e,{withFileTypes:!0})){const r=s.name,i=t.join(e,r);s.isDirectory()?n.directories.push({path:i,name:r}):s.isFile()&&n.files.push({path:i,name:r})}return n},t.FileScannerComputeHandler=class{constructor(e,t,r,n,s){this.controller=e,this.manipulator=t,this.fs=r,this.pathPredicate=n,this.directoryManager=s}compute(e){let t=this.controller.getEmptyValue();const{changes:r,dependencies:n}=this.addDirectory(e,t);for(const e of r)t=this.manipulator.reducer(t,e).value;return{value:t,dependencies:n,status:{valid:!0}}}recompute(e,t,r,n){const s=e.getLatest(),i=[];let a=new Set(n);for(const e of r){if(!e.isValid())continue;const r=e.getType(),{changes:n,dependencies:o}=this.getDirectoryRelatedUpdates(e,t[r][e.getSerializedId()],s,a);i.push(...n),a=o}const o=Array.from(n).filter((e=>!e.isValid()));return{dependencies:new Set([...a].filter((e=>!o.includes(e)))),changes:i,status:{valid:!0}}}addDirectory(e,t){const r=new Set,{files:n,directoryResources:s}=this.addDirRecurse(e),i=[],a=this.controller.onFilesAdded(t,n.map((({path:e})=>e)));return s.forEach((e=>r.add(e))),i.push(...a.changes),{changes:i,dependencies:r}}addDirRecurse(e,t=[],r=[],n=[]){const s=this.directoryManager.get(e);n.push(s);const i=s.getLatest();for(const s of i){const i={name:s.name,path:this.fs.join(e,s.name)};this.pathPredicate(i.path)&&(s.stats.isDirectory?(t.push(i),this.addDirRecurse(i.path,t,r,n)):s.stats.isFile&&this.controller.predicate(i.path)&&r.push(i))}return{files:r,directories:t,directoryResources:n}}getDirectoryRelatedUpdates(e,t,r,n){if(t.isDisposed())return{changes:[],dependencies:n};const i=[],a=new Set(n),o=e.getChangesFromVersion(t),c=e.getId();return o.forEach((e=>{if(e.kind===s.DirectoryChangeKind.ADD){const t=this.fs.join(c,e.node.name);if(e.node.stats.isDirectory){if(this.pathPredicate(t)){const{changes:e,dependencies:n}=this.addDirectory(t,r);for(const e of n)a.add(e);i.push(...e)}}else if(this.pathPredicate(t)&&this.controller.predicate(t)){const{changes:e}=this.controller.onFilesAdded(r,[t]);i.push(...e)}}else if(e.kind===s.DirectoryChangeKind.REMOVE){const t=this.fs.join(c,e.name);i.push(...this.controller.onRemoved(r,t))}})),{changes:i,dependencies:a}}}},33506:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.removePrefixPath=t.createPathPredicate=t.directoryDeepChildren=t.getPathsOfFilePath=t.getTreeNodePath=void 0;const n=r(71876),s=r(73654),i=r(91570);function a(e,t){return e.split(t).filter((e=>!!e))}function o(){return!0}t.getTreeNodePath=a,t.getPathsOfFilePath=function(e,t){var r;const n=e?a(e,t):[],s=[];for(let e=0;e<n.length;e++)s.push((null!==(r=s[e-1])&&void 0!==r?r:"")+t+n[e]);return s},t.directoryDeepChildren=async function*e(t,r,n=o,s=r){for(const i of await t.promises.readdir(r,{withFileTypes:!0})){const a=i.name,o=t.join(r,a),c=t.relative(s,o);if(i.isFile()){const e={type:"file",path:o,name:a,relativePath:c};n(e)&&(yield e)}else if(i.isDirectory()){const r={type:"directory",path:o,name:a,relativePath:c};n(r)&&(yield r,yield*e(t,o,n,s))}}},t.createPathPredicate=function(e,t,r){const s=r.map((e=>(0,n.makeRe)(e)));return r=>{const n=e.relative(t,r);return!s.some((e=>e.test(n)))}},t.removePrefixPath=(e,t)=>e?(0,i.replaceWinSlashes)(s.win32.relative(e,t)):(0,i.replaceWinSlashes)(t)},18012:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(5163);n.__exportStar(r(78204),t),n.__exportStar(r(98180),t),n.__exportStar(r(33506),t),n.__exportStar(r(98073),t),n.__exportStar(r(61276),t)},98073:(e,t)=>{"use strict";var r,n;Object.defineProperty(t,"__esModule",{value:!0}),t.NodeType=t.FsEventType=void 0,(n=t.FsEventType||(t.FsEventType={}))[n.CREATE=0]="CREATE",n[n.LOAD=1]="LOAD",n[n.UPDATE=2]="UPDATE",n[n.DELETE=3]="DELETE",(r=t.NodeType||(t.NodeType={}))[r.directory=0]="directory",r[r.file=1]="file",r[r.virtual=2]="virtual",r[r.none=3]="none"},69144:(e,t,r)=>{e.exports=r(18012)},8260:(e,t,r)=>{e.exports=r(45856)}}]);